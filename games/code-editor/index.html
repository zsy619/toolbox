<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ¨çº¿ä»£ç ç¼–è¾‘å™¨ - Code Editor | å¤šè¯­è¨€ç¼–ç¨‹ç¯å¢ƒ</title>
    <meta name="description" content="ä¸“ä¸šçš„åœ¨çº¿ä»£ç ç¼–è¾‘å™¨ï¼æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ã€è¯­æ³•é«˜äº®ã€è‡ªåŠ¨è¡¥å…¨ã€å®æ—¶é¢„è§ˆå’Œä»£ç æ ¼å¼åŒ–ï¼Œæä¾›å®Œæ•´çš„ç¼–ç¨‹å¼€å‘ä½“éªŒã€‚">
    <meta name="keywords" content="ä»£ç ç¼–è¾‘å™¨,Code Editor,åœ¨çº¿ç¼–ç¨‹,è¯­æ³•é«˜äº®,ä»£ç æ ¼å¼åŒ–,JavaScript,Python,HTML,CSS,ç¼–ç¨‹å·¥å…·">
    <meta name="author" content="Game Creator">
    <meta property="og:title" content="åœ¨çº¿ä»£ç ç¼–è¾‘å™¨ - Code Editor">
    <meta property="og:description" content="ä¸“ä¸šçš„åœ¨çº¿ä»£ç ç¼–è¾‘å™¨ï¼Œæ”¯æŒå¤šè¯­è¨€ç¼–ç¨‹å’Œå®æ—¶é¢„è§ˆ">
    <meta property="og:type" content="game">
    <link rel="canonical" href="/games/code-editor/">
    
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="editor-container">
        <div class="header">
            <h1>ğŸ’» åœ¨çº¿ä»£ç ç¼–è¾‘å™¨</h1>
            <div class="header-controls">
                <button class="btn small" id="newFileBtn">æ–°å»ºæ–‡ä»¶</button>
                <button class="btn small secondary" id="saveBtn">ä¿å­˜</button>
                <button class="btn small secondary" id="runBtn">è¿è¡Œ</button>
                <button class="btn small" id="formatBtn">æ ¼å¼åŒ–</button>
            </div>
        </div>

        <div class="sidebar">
            <div class="file-tree">
                <h3>ğŸ“ æ–‡ä»¶èµ„æºç®¡ç†å™¨</h3>
                <div id="fileList"></div>
                <button class="btn small" id="addFileBtn">+ æ·»åŠ æ–‡ä»¶</button>
            </div>

            <div class="language-selector">
                <h3>ğŸ”§ ç¼–ç¨‹è¯­è¨€</h3>
                <div class="language-grid">
                    <button class="language-btn active" data-lang="javascript">JavaScript</button>
                    <button class="language-btn" data-lang="python">Python</button>
                    <button class="language-btn" data-lang="html">HTML</button>
                    <button class="language-btn" data-lang="css">CSS</button>
                    <button class="language-btn" data-lang="json">JSON</button>
                    <button class="language-btn" data-lang="markdown">Markdown</button>
                </div>
            </div>

            <div class="tools-panel">
                <h3>ğŸ› ï¸ å¼€å‘å·¥å…·</h3>
                <div class="tool-group">
                    <h4>ä»£ç æ“ä½œ</h4>
                    <div class="tool-buttons">
                        <button class="btn small" id="undoBtn">æ’¤é”€</button>
                        <button class="btn small" id="redoBtn">é‡åš</button>
                        <button class="btn small" id="findBtn">æŸ¥æ‰¾</button>
                        <button class="btn small" id="replaceBtn">æ›¿æ¢</button>
                    </div>
                </div>
                <div class="tool-group">
                    <h4>è§†å›¾æ§åˆ¶</h4>
                    <div class="tool-buttons">
                        <button class="btn small secondary" id="consoleBtn">æ§åˆ¶å°</button>
                        <button class="btn small secondary" id="minimapBtn">å°åœ°å›¾</button>
                        <button class="btn small secondary" id="wrapBtn">è‡ªåŠ¨æ¢è¡Œ</button>
                        <button class="btn small secondary" id="fullscreenBtn">å…¨å±</button>
                    </div>
                </div>
            </div>

            <div class="settings-panel">
                <h3>âš™ï¸ ç¼–è¾‘å™¨è®¾ç½®</h3>
                <div class="setting-group">
                    <label class="setting-label" for="fontSize">å­—ä½“å¤§å°</label>
                    <input type="range" id="fontSize" class="setting-input" min="10" max="24" value="14">
                </div>
                <div class="setting-group">
                    <label class="setting-label" for="tabSize">Tabå¤§å°</label>
                    <select id="tabSize" class="setting-select">
                        <option value="2">2 ç©ºæ ¼</option>
                        <option value="4" selected>4 ç©ºæ ¼</option>
                        <option value="8">8 ç©ºæ ¼</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label class="setting-label" for="fontFamily">å­—ä½“</label>
                    <select id="fontFamily" class="setting-select">
                        <option value="JetBrains Mono">JetBrains Mono</option>
                        <option value="Fira Code">Fira Code</option>
                        <option value="Monaco">Monaco</option>
                        <option value="Consolas">Consolas</option>
                    </select>
                </div>
            </div>

            <div class="themes-panel">
                <h3>ğŸ¨ ä¸»é¢˜æ ·å¼</h3>
                <div class="theme-grid">
                    <button class="theme-btn active" data-theme="dark">æ·±è‰²</button>
                    <button class="theme-btn" data-theme="light">æµ…è‰²</button>
                    <button class="theme-btn" data-theme="monokai">Monokai</button>
                    <button class="theme-btn" data-theme="solarized">Solarized</button>
                </div>
            </div>
        </div>

        <div class="editor-area">
            <div class="editor-tabs" id="editorTabs"></div>
            <div class="editor-wrapper">
                <div class="line-numbers" id="lineNumbers"></div>
                <textarea class="code-editor" id="codeEditor" placeholder="å¼€å§‹ç¼–å†™ä»£ç ..."></textarea>
                <div class="minimap" id="minimap"></div>
                <div class="autocomplete-popup" id="autocompletePopup"></div>
            </div>
            <div class="console-panel" id="consolePanel"></div>
        </div>

        <div class="preview-area">
            <div class="preview-header">
                <div class="preview-title">ğŸ” å®æ—¶é¢„è§ˆ</div>
                <div>
                    <button class="btn small" id="refreshPreviewBtn">åˆ·æ–°</button>
                    <button class="btn small secondary" id="openInNewTabBtn">æ–°çª—å£</button>
                </div>
            </div>
            <div class="preview-content">
                <iframe class="preview-iframe" id="previewFrame"></iframe>
            </div>
        </div>

        <div class="status-bar">
            <div class="status-left">
                <span id="languageStatus">JavaScript</span>
                <span id="positionStatus">è¡Œ 1, åˆ— 1</span>
                <span id="selectionStatus"></span>
            </div>
            <div class="status-right">
                <span id="encodingStatus">UTF-8</span>
                <span id="fileStatus">æœªä¿å­˜</span>
                <span id="livePreview">é¢„è§ˆ: å¼€å¯</span>
            </div>
        </div>
    </div>

    
    <script src="js/game.js"></script>
</body>
</html>`,
                    css: `/* æ¬¢è¿ä½¿ç”¨CSSç¼–è¾‘å™¨ */
body {
    font-family: 'Arial', sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
}

.container {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 40px;
    text-align: center;
    color: white;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.title {
    font-size: 2.5rem;
    margin-bottom: 20px;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.description {
    font-size: 1.2rem;
    margin-bottom: 30px;
    opacity: 0.9;
}

.button {
    background: linear-gradient(135deg, #ff6b6b, #ee5a24);
    color: white;
    border: none;
    padding: 15px 30px;
    border-radius: 10px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(238, 90, 36, 0.3);
}

.button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(238, 90, 36, 0.4);
}`,
                    python: `# æ¬¢è¿ä½¿ç”¨Pythonç¼–è¾‘å™¨ï¼
print("Hello, World!")

# è¿™æ˜¯ä¸€ä¸ªç®€å•çš„Pythonç¤ºä¾‹
def greet_user(name):
    return f"Hello, {name}! æ¬¢è¿ä½¿ç”¨ä»£ç ç¼–è¾‘å™¨ã€‚"

# è°ƒç”¨å‡½æ•°
message = greet_user("å¼€å‘è€…")
print(message)

# ä¸€ä¸ªç®€å•çš„è®¡ç®—å™¨
def calculator(a, b, operation):
    if operation == "+":
        return a + b
    elif operation == "-":
        return a - b
    elif operation == "*":
        return a * b
    elif operation == "/":
        return a / b if b != 0 else "ä¸èƒ½é™¤ä»¥é›¶"
    else:
        return "æœªçŸ¥æ“ä½œ"

# æµ‹è¯•è®¡ç®—å™¨
result = calculator(10, 5, "+")
print(f"10 + 5 = {result}")

# ä½ å¯ä»¥åœ¨è¿™é‡Œç¼–å†™æ›´å¤šPythonä»£ç ...`,
                    json: `{
  "name": "æˆ‘çš„é¡¹ç›®",
  "version": "1.0.0",
  "description": "è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹JSONæ–‡ä»¶",
  "author": "å¼€å‘è€…",
  "main": "index.js",
  "scripts": {
    "start": "node index.js",
    "build": "webpack --mode production",
    "dev": "webpack-dev-server --mode development"
  },
  "dependencies": {
    "express": "^4.17.1",
    "lodash": "^4.17.21",
    "moment": "^2.29.1"
  },
  "devDependencies": {
    "webpack": "^5.0.0",
    "webpack-cli": "^4.0.0"
  },
  "keywords": [
    "javascript",
    "nodejs",
    "web"
  ],
  "license": "MIT"
}`,
                    markdown: `# ğŸ“ æ¬¢è¿ä½¿ç”¨Markdownç¼–è¾‘å™¨

è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„**Markdownç¼–è¾‘å™¨**ï¼Œæ”¯æŒå®æ—¶é¢„è§ˆã€‚

## ğŸš€ ç‰¹æ€§

- âœ… å®æ—¶é¢„è§ˆ
- âœ… è¯­æ³•é«˜äº®
- âœ… å¤šç§ä¸»é¢˜
- âœ… è‡ªåŠ¨ä¿å­˜

## ğŸ“– è¯­æ³•ç¤ºä¾‹

### æ–‡æœ¬æ ¼å¼

*æ–œä½“æ–‡æœ¬*  
**ç²—ä½“æ–‡æœ¬**  
***ç²—æ–œä½“æ–‡æœ¬***  
~~åˆ é™¤çº¿æ–‡æœ¬~~

### ä»£ç å—

\`\`\`javascript
function hello() {
    console.log("Hello, World!");
}
\`\`\`

### åˆ—è¡¨

1. ç¬¬ä¸€é¡¹
2. ç¬¬äºŒé¡¹
3. ç¬¬ä¸‰é¡¹

- æ— åºåˆ—è¡¨é¡¹ä¸€
- æ— åºåˆ—è¡¨é¡¹äºŒ
- æ— åºåˆ—è¡¨é¡¹ä¸‰

### é“¾æ¥å’Œå›¾ç‰‡

[GitHub](https://github.com)

### è¡¨æ ¼

| å§“å | å¹´é¾„ | åŸå¸‚ |
|------|------|------|
| å¼ ä¸‰ | 25   | åŒ—äº¬ |
| æå›› | 30   | ä¸Šæµ· |

### å¼•ç”¨

> è¿™æ˜¯ä¸€ä¸ªå¼•ç”¨å—ã€‚
> å¯ä»¥åŒ…å«å¤šè¡Œå†…å®¹ã€‚

---

**å¼€å§‹ç¼–å†™ä½ çš„Markdownæ–‡æ¡£å§ï¼** ğŸ‰`
                };

                this.createFile('main.' + this.getFileExtension(this.currentLanguage), defaultContent[this.currentLanguage] || defaultContent.javascript);
            }

            createFile(name, content = '') {
                const fileId = `file_${++this.fileCounter}`;
                const file = {
                    id: fileId,
                    name: name,
                    content: content,
                    language: this.detectLanguage(name),
                    modified: false,
                    created: new Date()
                };

                this.files.set(fileId, file);
                this.currentFile = fileId;
                this.updateFileList();
                this.updateEditorTabs();
                this.loadFile(fileId);
                
                return fileId;
            }

            createNewFile() {
                const name = prompt('è¯·è¾“å…¥æ–‡ä»¶å:', 'untitled.' + this.getFileExtension(this.currentLanguage));
                if (name) {
                    this.createFile(name);
                }
            }

            addFileDialog() {
                this.createNewFile();
            }

            loadFile(fileId) {
                const file = this.files.get(fileId);
                if (!file) return;

                this.currentFile = fileId;
                const codeEditor = document.getElementById('codeEditor');
                codeEditor.value = file.content;
                
                this.setLanguage(file.language);
                this.updateLineNumbers();
                this.updateCursorPosition();
                this.updateFileStatus();
                this.updateEditorTabs();
                
                if (this.settings.livePreview) {
                    this.updatePreview();
                }
            }

            saveFile() {
                if (!this.currentFile) return;

                const file = this.files.get(this.currentFile);
                if (!file) return;

                const codeEditor = document.getElementById('codeEditor');
                file.content = codeEditor.value;
                file.modified = false;
                file.lastSaved = new Date();

                this.updateFileStatus();
                this.updateEditorTabs();
                
                // æ¨¡æ‹Ÿä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                this.saveToLocalStorage();
                
                this.showMessage('æ–‡ä»¶å·²ä¿å­˜', 'success');
            }

            deleteFile(fileId) {
                if (this.files.size <= 1) {
                    this.showMessage('è‡³å°‘éœ€è¦ä¿ç•™ä¸€ä¸ªæ–‡ä»¶', 'warning');
                    return;
                }

                if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡ä»¶å—ï¼Ÿ')) {
                    this.files.delete(fileId);
                    
                    if (this.currentFile === fileId) {
                        const remainingFiles = Array.from(this.files.keys());
                        this.loadFile(remainingFiles[0]);
                    }
                    
                    this.updateFileList();
                    this.updateEditorTabs();
                }
            }

            onCodeChange() {
                if (!this.currentFile) return;

                const file = this.files.get(this.currentFile);
                if (!file) return;

                const codeEditor = document.getElementById('codeEditor');
                file.content = codeEditor.value;
                file.modified = true;

                this.updateFileStatus();
                this.updateEditorTabs();
                this.applySyntaxHighlighting();
            }

            updateFileList() {
                const fileList = document.getElementById('fileList');
                fileList.innerHTML = '';

                this.files.forEach((file, fileId) => {
                    const fileItem = document.createElement('div');
                    fileItem.className = `file-item ${fileId === this.currentFile ? 'active' : ''}`;
                    fileItem.innerHTML = `
                        <span class="file-icon">${this.getFileIcon(file.language)}</span>
                        <span class="file-name">${file.name}${file.modified ? ' *' : ''}</span>
                    `;
                    
                    fileItem.addEventListener('click', () => this.loadFile(fileId));
                    fileItem.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        this.showFileContextMenu(e, fileId);
                    });
                    
                    fileList.appendChild(fileItem);
                });
            }

            updateEditorTabs() {
                const editorTabs = document.getElementById('editorTabs');
                editorTabs.innerHTML = '';

                this.files.forEach((file, fileId) => {
                    const tab = document.createElement('button');
                    tab.className = `editor-tab ${fileId === this.currentFile ? 'active' : ''}`;
                    tab.innerHTML = `
                        <span>${file.name}${file.modified ? ' *' : ''}</span>
                        <button class="tab-close" onclick="event.stopPropagation(); editor.closeFile('${fileId}')">Ã—</button>
                    `;
                    
                    tab.addEventListener('click', () => this.loadFile(fileId));
                    editorTabs.appendChild(tab);
                });
            }

            closeFile(fileId) {
                const file = this.files.get(fileId);
                if (file && file.modified) {
                    if (!confirm('æ–‡ä»¶æœªä¿å­˜ï¼Œç¡®å®šè¦å…³é—­å—ï¼Ÿ')) {
                        return;
                    }
                }

                this.deleteFile(fileId);
            }

            getFileIcon(language) {
                const icons = {
                    javascript: 'ğŸ“„',
                    html: 'ğŸŒ',
                    css: 'ğŸ¨',
                    python: 'ğŸ',
                    json: 'ğŸ“‹',
                    markdown: 'ğŸ“'
                };
                return icons[language] || 'ğŸ“„';
            }

            getFileExtension(language) {
                const extensions = {
                    javascript: 'js',
                    html: 'html',
                    css: 'css',
                    python: 'py',
                    json: 'json',
                    markdown: 'md'
                };
                return extensions[language] || 'txt';
            }

            detectLanguage(filename) {
                const ext = filename.split('.').pop().toLowerCase();
                const languageMap = {
                    js: 'javascript',
                    html: 'html',
                    htm: 'html',
                    css: 'css',
                    py: 'python',
                    json: 'json',
                    md: 'markdown'
                };
                return languageMap[ext] || 'javascript';
            }

            setLanguage(language) {
                this.currentLanguage = language;
                document.getElementById('languageStatus').textContent = language.charAt(0).toUpperCase() + language.slice(1);
                
                if (this.currentFile) {
                    const file = this.files.get(this.currentFile);
                    if (file) {
                        file.language = language;
                    }
                }

                this.applySyntaxHighlighting();
                this.updateFileList();
            }

            updateLineNumbers() {
                const codeEditor = document.getElementById('codeEditor');
                const lineNumbers = document.getElementById('lineNumbers');
                
                const lines = codeEditor.value.split('\n');
                const lineNumbersText = lines.map((_, index) => index + 1).join('\n');
                lineNumbers.textContent = lineNumbersText;
            }

            syncLineNumbers() {
                const codeEditor = document.getElementById('codeEditor');
                const lineNumbers = document.getElementById('lineNumbers');
                lineNumbers.scrollTop = codeEditor.scrollTop;
            }

            updateCursorPosition() {
                const codeEditor = document.getElementById('codeEditor');
                const text = codeEditor.value;
                const cursorPos = codeEditor.selectionStart;
                
                const lines = text.substring(0, cursorPos).split('\n');
                const currentLine = lines.length;
                const currentColumn = lines[lines.length - 1].length + 1;
                
                document.getElementById('positionStatus').textContent = `è¡Œ ${currentLine}, åˆ— ${currentColumn}`;
                
                const selectionLength = codeEditor.selectionEnd - codeEditor.selectionStart;
                if (selectionLength > 0) {
                    document.getElementById('selectionStatus').textContent = `é€‰ä¸­ ${selectionLength} ä¸ªå­—ç¬¦`;
                } else {
                    document.getElementById('selectionStatus').textContent = '';
                }
            }

            updateFileStatus() {
                if (!this.currentFile) {
                    document.getElementById('fileStatus').textContent = 'æ— æ–‡ä»¶';
                    return;
                }

                const file = this.files.get(this.currentFile);
                if (!file) return;

                document.getElementById('fileStatus').textContent = file.modified ? 'æœªä¿å­˜' : 'å·²ä¿å­˜';
            }

            handleKeyDown(e) {
                const codeEditor = document.getElementById('codeEditor');
                
                if (e.key === 'Tab') {
                    e.preventDefault();
                    const start = codeEditor.selectionStart;
                    const end = codeEditor.selectionEnd;
                    const spaces = ' '.repeat(this.settings.tabSize);
                    
                    codeEditor.value = codeEditor.value.substring(0, start) + spaces + codeEditor.value.substring(end);
                    codeEditor.selectionStart = codeEditor.selectionEnd = start + spaces.length;
                    
                    this.onCodeChange();
                } else if (e.key === 'Enter') {
                    // è‡ªåŠ¨ç¼©è¿›
                    setTimeout(() => {
                        const lines = codeEditor.value.substring(0, codeEditor.selectionStart).split('\n');
                        const currentLine = lines[lines.length - 2] || '';
                        const indent = currentLine.match(/^\s*/)[0];
                        
                        if (currentLine.trim().endsWith('{') || currentLine.trim().endsWith(':')) {
                            const newIndent = indent + ' '.repeat(this.settings.tabSize);
                            const start = codeEditor.selectionStart;
                            codeEditor.value = codeEditor.value.substring(0, start) + newIndent + codeEditor.value.substring(start);
                            codeEditor.selectionStart = codeEditor.selectionEnd = start + newIndent.length;
                        } else if (indent) {
                            const start = codeEditor.selectionStart;
                            codeEditor.value = codeEditor.value.substring(0, start) + indent + codeEditor.value.substring(start);
                            codeEditor.selectionStart = codeEditor.selectionEnd = start + indent.length;
                        }
                        
                        this.onCodeChange();
                    }, 0);
                }
                
                this.updateCursorPosition();
            }

            showAutocomplete() {
                const codeEditor = document.getElementById('codeEditor');
                const popup = document.getElementById('autocompletePopup');
                
                if (!this.settings.autoComplete) {
                    popup.style.display = 'none';
                    return;
                }

                const cursorPos = codeEditor.selectionStart;
                const text = codeEditor.value.substring(0, cursorPos);
                const words = text.split(/\s+/);
                const currentWord = words[words.length - 1];

                if (currentWord.length < 2) {
                    popup.style.display = 'none';
                    return;
                }

                const suggestions = this.getAutocompleteSuggestions(currentWord);
                if (suggestions.length === 0) {
                    popup.style.display = 'none';
                    return;
                }

                this.showAutocompleteSuggestions(suggestions, currentWord);
            }

            getAutocompleteSuggestions(word) {
                const data = this.autocompleteData[this.currentLanguage] || [];
                return data.filter(item => 
                    item.name.toLowerCase().startsWith(word.toLowerCase())
                ).slice(0, 10);
            }

            showAutocompleteSuggestions(suggestions, word) {
                const popup = document.getElementById('autocompletePopup');
                const codeEditor = document.getElementById('codeEditor');
                
                popup.innerHTML = '';
                suggestions.forEach((suggestion, index) => {
                    const item = document.createElement('div');
                    item.className = `autocomplete-item ${index === 0 ? 'selected' : ''}`;
                    item.innerHTML = `
                        <span class="autocomplete-icon">${this.getAutocompleteIcon(suggestion.type)}</span>
                        <span>${suggestion.name}</span>
                    `;
                    
                    item.addEventListener('click', () => {
                        this.insertAutocompletion(word, suggestion.name);
                        this.hideAutocomplete();
                    });
                    
                    popup.appendChild(item);
                });

                // å®šä½å¼¹çª—
                const rect = codeEditor.getBoundingClientRect();
                const textRect = this.getCursorPosition();
                popup.style.left = `${textRect.left}px`;
                popup.style.top = `${textRect.top + 20}px`;
                popup.style.display = 'block';
            }

            hideAutocomplete() {
                document.getElementById('autocompletePopup').style.display = 'none';
            }

            insertAutocompletion(word, completion) {
                const codeEditor = document.getElementById('codeEditor');
                const cursorPos = codeEditor.selectionStart;
                const text = codeEditor.value;
                
                const beforeCursor = text.substring(0, cursorPos - word.length);
                const afterCursor = text.substring(cursorPos);
                
                codeEditor.value = beforeCursor + completion + afterCursor;
                codeEditor.selectionStart = codeEditor.selectionEnd = beforeCursor.length + completion.length;
                
                this.onCodeChange();
                codeEditor.focus();
            }

            getAutocompleteIcon(type) {
                const icons = {
                    keyword: 'K',
                    function: 'F',
                    method: 'M',
                    property: 'P',
                    tag: 'T',
                    variable: 'V'
                };
                return icons[type] || 'I';
            }

            getCursorPosition() {
                const codeEditor = document.getElementById('codeEditor');
                const rect = codeEditor.getBoundingClientRect();
                
                // ç®€åŒ–å®ç°ï¼Œè¿”å›ç¼–è¾‘å™¨ä½ç½®
                return {
                    left: rect.left + 50,
                    top: rect.top + 50
                };
            }

            applySyntaxHighlighting() {
                // ç®€åŒ–çš„è¯­æ³•é«˜äº®å®ç°
                // åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ›´å¼ºå¤§çš„è¯­æ³•é«˜äº®åº“å¦‚ Prism.js æˆ– highlight.js
            }

            formatCode() {
                const codeEditor = document.getElementById('codeEditor');
                let code = codeEditor.value;
                
                try {
                    switch (this.currentLanguage) {
                        case 'javascript':
                            code = this.formatJavaScript(code);
                            break;
                        case 'html':
                            code = this.formatHTML(code);
                            break;
                        case 'css':
                            code = this.formatCSS(code);
                            break;
                        case 'json':
                            code = JSON.stringify(JSON.parse(code), null, this.settings.tabSize);
                            break;
                    }
                    
                    codeEditor.value = code;
                    this.onCodeChange();
                    this.showMessage('ä»£ç æ ¼å¼åŒ–å®Œæˆ', 'success');
                } catch (error) {
                    this.showMessage('ä»£ç æ ¼å¼åŒ–å¤±è´¥: ' + error.message, 'error');
                }
            }

            formatJavaScript(code) {
                // ç®€åŒ–çš„JavaScriptæ ¼å¼åŒ–
                return code
                    .split('\n')
                    .map(line => line.trim())
                    .filter(line => line.length > 0)
                    .join('\n');
            }

            formatHTML(code) {
                // ç®€åŒ–çš„HTMLæ ¼å¼åŒ–
                let indent = 0;
                const tabSize = this.settings.tabSize;
                
                return code
                    .replace(/></g, '>\n<')
                    .split('\n')
                    .map(line => {
                        line = line.trim();
                        if (line.startsWith('</')) {
                            indent = Math.max(0, indent - tabSize);
                        }
                        const formatted = ' '.repeat(indent) + line;
                        if (line.startsWith('<') && !line.startsWith('</') && !line.endsWith('/>')) {
                            indent += tabSize;
                        }
                        return formatted;
                    })
                    .join('\n');
            }

            formatCSS(code) {
                // ç®€åŒ–çš„CSSæ ¼å¼åŒ–
                return code
                    .replace(/\{/g, ' {\n')
                    .replace(/\}/g, '\n}\n')
                    .replace(/;/g, ';\n')
                    .split('\n')
                    .map(line => {
                        line = line.trim();
                        if (line && !line.includes('{') && !line.includes('}')) {
                            return '    ' + line;
                        }
                        return line;
                    })
                    .filter(line => line.length > 0)
                    .join('\n');
            }

            runCode() {
                if (this.currentLanguage === 'javascript') {
                    this.runJavaScript();
                } else if (this.currentLanguage === 'python') {
                    this.runPython();
                } else {
                    this.updatePreview();
                }
            }

            runJavaScript() {
                const codeEditor = document.getElementById('codeEditor');
                const code = codeEditor.value;
                
                this.clearConsole();
                this.showConsole();
                
                try {
                    // é‡å®šå‘console.log
                    const originalLog = console.log;
                    console.log = (...args) => {
                        this.addConsoleMessage(args.join(' '), 'info');
                        originalLog.apply(console, args);
                    };
                    
                    // æ‰§è¡Œä»£ç 
                    eval(code);
                    
                    // æ¢å¤console.log
                    console.log = originalLog;
                    
                    this.addConsoleMessage('ä»£ç æ‰§è¡Œå®Œæˆ', 'info');
                } catch (error) {
                    this.addConsoleMessage(`é”™è¯¯: ${error.message}`, 'error');
                }
            }

            runPython() {
                this.addConsoleMessage('Pythonä»£ç æ‰§è¡Œéœ€è¦æœåŠ¡å™¨æ”¯æŒ', 'warn');
                this.showConsole();
            }

            updatePreview() {
                const previewFrame = document.getElementById('previewFrame');
                
                if (this.currentLanguage === 'html') {
                    const content = document.getElementById('codeEditor').value;
                    const blob = new Blob([content], { type: 'text/html' });
                    const url = URL.createObjectURL(blob);
                    previewFrame.src = url;
                } else if (this.currentLanguage === 'markdown') {
                    const content = this.renderMarkdown(document.getElementById('codeEditor').value);
                    const blob = new Blob([content], { type: 'text/html' });
                    const url = URL.createObjectURL(blob);
                    previewFrame.src = url;
                } else {
                    previewFrame.src = 'data:text/html,<h2>æ­¤è¯­è¨€ä¸æ”¯æŒé¢„è§ˆ</h2>';
                }
            }

            renderMarkdown(markdown) {
                // ç®€åŒ–çš„Markdownæ¸²æŸ“
                return `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        
                        <link rel="stylesheet" href="css/style.css">
</head>
                    <body>
                        <div>${this.parseMarkdown(markdown)}</div>
                        <script src="js/game.js"></script>
</body>
                    </html>
                `;
            }

            parseMarkdown(text) {
                return text
                    .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                    .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                    .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                    .replace(/\*\*\*(.*)\*\*\*/gim, '<strong><em>$1</em></strong>')
                    .replace(/\*\*(.*)\*\*/gim, '<strong>$1</strong>')
                    .replace(/\*(.*)\*/gim, '<em>$1</em>')
                    .replace(/~~(.*)~~/gim, '<del>$1</del>')
                    .replace(/`([^`]+)`/gim, '<code>$1</code>')
                    .replace(/\n/gim, '<br>');
            }

            openInNewTab() {
                if (this.currentLanguage === 'html') {
                    const content = document.getElementById('codeEditor').value;
                    const newWindow = window.open();
                    newWindow.document.write(content);
                    newWindow.document.close();
                }
            }

            toggleConsole() {
                const consolePanel = document.getElementById('consolePanel');
                this.settings.showConsole = !this.settings.showConsole;
                
                if (this.settings.showConsole) {
                    consolePanel.classList.add('show');
                    this.addConsoleMessage('æ§åˆ¶å°å·²æ‰“å¼€', 'info');
                } else {
                    consolePanel.classList.remove('show');
                }
            }

            showConsole() {
                const consolePanel = document.getElementById('consolePanel');
                this.settings.showConsole = true;
                consolePanel.classList.add('show');
            }

            clearConsole() {
                document.getElementById('consolePanel').innerHTML = '';
            }

            addConsoleMessage(message, type = 'info') {
                const consolePanel = document.getElementById('consolePanel');
                const line = document.createElement('div');
                line.className = `console-line console-${type}`;
                line.textContent = `${new Date().toLocaleTimeString()} ${message}`;
                consolePanel.appendChild(line);
                consolePanel.scrollTop = consolePanel.scrollHeight;
            }

            toggleMinimap() {
                const minimap = document.getElementById('minimap');
                this.settings.showMinimap = !this.settings.showMinimap;
                minimap.style.display = this.settings.showMinimap ? 'block' : 'none';
            }

            toggleWordWrap() {
                const codeEditor = document.getElementById('codeEditor');
                this.settings.wordWrap = !this.settings.wordWrap;
                codeEditor.style.whiteSpace = this.settings.wordWrap ? 'pre-wrap' : 'pre';
            }

            toggleFullscreen() {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen();
                } else {
                    document.exitFullscreen();
                }
            }

            saveToHistory() {
                if (!this.currentFile) return;
                
                const file = this.files.get(this.currentFile);
                if (!file) return;
                
                const state = {
                    fileId: this.currentFile,
                    content: file.content,
                    timestamp: Date.now()
                };
                
                this.history.push(state);
                if (this.history.length > this.maxHistorySize) {
                    this.history.shift();
                }
                this.historyIndex = this.history.length - 1;
            }

            undo() {
                if (this.historyIndex > 0) {
                    this.historyIndex--;
                    const state = this.history[this.historyIndex];
                    
                    const file = this.files.get(state.fileId);
                    if (file) {
                        file.content = state.content;
                        document.getElementById('codeEditor').value = state.content;
                        this.updateLineNumbers();
                    }
                }
            }

            redo() {
                if (this.historyIndex < this.history.length - 1) {
                    this.historyIndex++;
                    const state = this.history[this.historyIndex];
                    
                    const file = this.files.get(state.fileId);
                    if (file) {
                        file.content = state.content;
                        document.getElementById('codeEditor').value = state.content;
                        this.updateLineNumbers();
                    }
                }
            }

            showFindDialog() {
                const searchTerm = prompt('æŸ¥æ‰¾:');
                if (searchTerm) {
                    this.findText(searchTerm);
                }
            }

            showReplaceDialog() {
                const searchTerm = prompt('æŸ¥æ‰¾:');
                if (searchTerm) {
                    const replaceTerm = prompt('æ›¿æ¢ä¸º:');
                    if (replaceTerm !== null) {
                        this.replaceText(searchTerm, replaceTerm);
                    }
                }
            }

            findText(searchTerm) {
                const codeEditor = document.getElementById('codeEditor');
                const content = codeEditor.value;
                const index = content.indexOf(searchTerm);
                
                if (index !== -1) {
                    codeEditor.focus();
                    codeEditor.setSelectionRange(index, index + searchTerm.length);
                    this.showMessage(`æ‰¾åˆ° "${searchTerm}"`, 'success');
                } else {
                    this.showMessage(`æœªæ‰¾åˆ° "${searchTerm}"`, 'warning');
                }
            }

            replaceText(searchTerm, replaceTerm) {
                const codeEditor = document.getElementById('codeEditor');
                const content = codeEditor.value;
                const newContent = content.replace(new RegExp(searchTerm, 'g'), replaceTerm);
                
                codeEditor.value = newContent;
                this.onCodeChange();
                this.showMessage(`å·²æ›¿æ¢æ‰€æœ‰ "${searchTerm}"`, 'success');
            }

            setTheme(theme) {
                this.settings.theme = theme;
                this.applyTheme();
                this.saveSettings();
            }

            applyTheme() {
                const themeData = this.themes[this.settings.theme];
                if (!themeData) return;

                const codeEditor = document.getElementById('codeEditor');
                const lineNumbers = document.getElementById('lineNumbers');

                codeEditor.style.backgroundColor = themeData.background;
                codeEditor.style.color = themeData.color;
                lineNumbers.style.backgroundColor = themeData.lineNumberBg;
                lineNumbers.style.color = themeData.lineNumberColor;
            }

            applySettings() {
                const codeEditor = document.getElementById('codeEditor');
                
                codeEditor.style.fontSize = this.settings.fontSize + 'px';
                codeEditor.style.fontFamily = this.settings.fontFamily;
                codeEditor.style.tabSize = this.settings.tabSize;
                
                document.getElementById('lineNumbers').style.fontSize = this.settings.fontSize + 'px';
                document.getElementById('lineNumbers').style.fontFamily = this.settings.fontFamily;

                this.updateLineNumbers();
                this.saveSettings();
            }

            saveSettings() {
                localStorage.setItem('codeEditorSettings', JSON.stringify(this.settings));
            }

            loadSettings() {
                const saved = localStorage.getItem('codeEditorSettings');
                if (saved) {
                    try {
                        this.settings = { ...this.settings, ...JSON.parse(saved) };
                        
                        document.getElementById('fontSize').value = this.settings.fontSize;
                        document.getElementById('tabSize').value = this.settings.tabSize;
                        document.getElementById('fontFamily').value = this.settings.fontFamily;
                        
                        this.applySettings();
                    } catch (error) {
                        console.error('åŠ è½½è®¾ç½®å¤±è´¥:', error);
                    }
                }
            }

            saveToLocalStorage() {
                const data = {
                    files: Array.from(this.files.entries()),
                    currentFile: this.currentFile,
                    settings: this.settings
                };
                localStorage.setItem('codeEditorData', JSON.stringify(data));
            }

            loadFromLocalStorage() {
                const saved = localStorage.getItem('codeEditorData');
                if (saved) {
                    try {
                        const data = JSON.parse(saved);
                        this.files = new Map(data.files);
                        this.currentFile = data.currentFile;
                        this.settings = { ...this.settings, ...data.settings };
                        
                        if (this.files.size > 0) {
                            this.updateFileList();
                            this.updateEditorTabs();
                            if (this.currentFile && this.files.has(this.currentFile)) {
                                this.loadFile(this.currentFile);
                            }
                        }
                    } catch (error) {
                        console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                    }
                }
            }

            showMessage(message, type = 'info') {
                // ç®€åŒ–çš„æ¶ˆæ¯æ˜¾ç¤º
                console.log(`[${type.toUpperCase()}] ${message}`);
                
                // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ›´å¥½çš„æ¶ˆæ¯æ˜¾ç¤ºUI
                const statusBar = document.querySelector('.status-bar .status-right');
                const messageEl = document.createElement('span');
                messageEl.textContent = message;
                messageEl.style.color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#4ecdc4' : '#ffd93d';
                
                statusBar.appendChild(messageEl);
                setTimeout(() => {
                    statusBar.removeChild(messageEl);
                }, 3000);
            }

            showFileContextMenu(e, fileId) {
                // ç®€åŒ–çš„å³é”®èœå•å®ç°
                if (confirm('åˆ é™¤è¿™ä¸ªæ–‡ä»¶ï¼Ÿ')) {
                    this.deleteFile(fileId);
                }
            }
        }

        // å…¨å±€å˜é‡ç”¨äºè®¿é—®ç¼–è¾‘å™¨å®ä¾‹
        let editor;

        // åˆå§‹åŒ–ç¼–è¾‘å™¨
        document.addEventListener('DOMContentLoaded', () => {
            editor = new CodeEditor();
        });
    </script>
    <script src="js/game.js"></script>
</body>
</html>