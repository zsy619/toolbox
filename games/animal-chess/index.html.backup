<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–—å…½æ£‹ - åŠ¨ç‰©ç‹å›½å¤§æˆ˜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 50%, #00b894 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            max-width: 800px;
            width: 100%;
        }

        .game-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .game-title {
            font-size: 2.5em;
            font-weight: 700;
            color: #2d3436;
            margin-bottom: 10px;
        }

        .game-subtitle {
            color: #636e72;
            font-size: 1.1em;
        }

        .game-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
            font-weight: bold;
            color: #2d3436;
        }

        .info-item {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .red-info {
            color: #e74c3c;
        }

        .blue-info {
            color: #3498db;
        }

        .turn-info {
            color: #27ae60;
        }

        .board-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        .chess-board {
            display: grid;
            grid-template-columns: repeat(7, 60px);
            grid-template-rows: repeat(9, 60px);
            gap: 1px;
            background: #34495e;
            padding: 10px;
            border-radius: 10px;
        }

        .chess-cell {
            background: #2ecc71;
            border: 1px solid #27ae60;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 24px;
            position: relative;
        }

        .chess-cell:hover {
            background: #58d68d;
        }

        .chess-cell.selected {
            background: #f39c12;
            box-shadow: 0 0 10px rgba(243, 156, 18, 0.8);
        }

        .chess-cell.possible-move {
            background: #3498db;
            animation: pulse 1s infinite;
        }

        .chess-cell.water {
            background: #3498db;
            background-image: radial-gradient(circle, rgba(255,255,255,0.3) 2px, transparent 2px);
            background-size: 10px 10px;
        }

        .chess-cell.trap {
            background: #e74c3c;
            background-image: 
                linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.3) 50%, transparent 60%),
                linear-gradient(-45deg, transparent 40%, rgba(255,255,255,0.3) 50%, transparent 60%);
        }

        .chess-cell.den {
            background: #9b59b6;
            background-image: 
                radial-gradient(circle at 50% 50%, rgba(255,255,255,0.3) 30%, transparent 40%);
        }

        .chess-piece {
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 2px solid;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        .red-piece {
            background: linear-gradient(145deg, #e74c3c, #c0392b);
            border-color: #a93226;
        }

        .blue-piece {
            background: linear-gradient(145deg, #3498db, #2980b9);
            border-color: #1f4e79;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .game-controls {
            text-align: center;
            margin: 20px 0;
        }

        .control-button {
            padding: 12px 25px;
            background: #74b9ff;
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
        }

        .control-button:hover {
            background: #0984e3;
            transform: translateY(-2px);
        }

        .control-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .message {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: bold;
            display: none;
        }

        .message.show {
            display: block;
        }

        .message.info {
            background: #e8f4f8;
            color: #2980b9;
        }

        .message.success {
            background: #d5f4e6;
            color: #00b894;
        }

        .message.error {
            background: #ffeaa7;
            color: #e17055;
        }

        .animal-info {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 20px 0;
            font-size: 12px;
        }

        .animal-card {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .animal-card.red {
            border-left: 4px solid #e74c3c;
        }

        .animal-card.blue {
            border-left: 4px solid #3498db;
        }

        .animal-rank {
            font-weight: bold;
            color: #2d3436;
        }

        .animal-emoji {
            font-size: 16px;
            margin: 5px 0;
        }

        @media (max-width: 768px) {
            .game-container {
                padding: 20px;
                margin: 10px;
            }

            .chess-board {
                grid-template-columns: repeat(7, 45px);
                grid-template-rows: repeat(9, 45px);
            }

            .chess-cell {
                font-size: 18px;
            }

            .chess-piece {
                width: 38px;
                height: 38px;
                font-size: 16px;
            }

            .animal-info {
                grid-template-columns: repeat(2, 1fr);
            }

            .game-title {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1 class="game-title">ğŸ¦ æ–—å…½æ£‹</h1>
            <p class="game-subtitle">åŠ¨ç‰©ç‹å›½å¤§æˆ˜ - ä¸›æ—ä¹‹ç‹äº‰éœ¸èµ›ï¼</p>
        </div>

        <div class="game-info">
            <div class="info-item red-info">
                çº¢æ–¹åŠ¨ç‰©: <span id="redCount">8</span>
            </div>
            <div class="info-item turn-info">
                å½“å‰å›åˆ: <span id="currentTurn">çº¢æ–¹</span>
            </div>
            <div class="info-item blue-info">
                è“æ–¹åŠ¨ç‰©: <span id="blueCount">8</span>
            </div>
        </div>

        <div class="board-container">
            <div class="chess-board" id="chessBoard">
                <!-- æ£‹ç›˜åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <div class="message" id="message"></div>

        <div class="animal-info">
            <div class="animal-card red">
                <div class="animal-rank">1</div>
                <div class="animal-emoji">ğŸ­</div>
                <div>é¼  (å…‹è±¡)</div>
            </div>
            <div class="animal-card red">
                <div class="animal-rank">2</div>
                <div class="animal-emoji">ğŸ±</div>
                <div>çŒ« (å…‹é¼ )</div>
            </div>
            <div class="animal-card red">
                <div class="animal-rank">3</div>
                <div class="animal-emoji">ğŸ•</div>
                <div>ç‹— (å…‹çŒ«)</div>
            </div>
            <div class="animal-card red">
                <div class="animal-rank">4</div>
                <div class="animal-emoji">ğŸº</div>
                <div>ç‹¼ (å…‹ç‹—)</div>
            </div>
            <div class="animal-card blue">
                <div class="animal-rank">5</div>
                <div class="animal-emoji">ğŸ†</div>
                <div>è±¹ (å…‹ç‹¼)</div>
            </div>
            <div class="animal-card blue">
                <div class="animal-rank">6</div>
                <div class="animal-emoji">ğŸ…</div>
                <div>è™ (å…‹è±¹)</div>
            </div>
            <div class="animal-card blue">
                <div class="animal-rank">7</div>
                <div class="animal-emoji">ğŸ¦</div>
                <div>ç‹® (å…‹è™)</div>
            </div>
            <div class="animal-card blue">
                <div class="animal-rank">8</div>
                <div class="animal-emoji">ğŸ˜</div>
                <div>è±¡ (è¢«é¼ å…‹)</div>
            </div>
        </div>

        <div class="game-controls">
            <button class="control-button" id="startButton">å¼€å§‹æ¸¸æˆ</button>
            <button class="control-button" id="resetButton">é‡æ–°å¼€å§‹</button>
            <button class="control-button" id="rulesButton">æ¸¸æˆè§„åˆ™</button>
        </div>
    </div>

    <script>
        class AnimalChess {
            constructor() {
                this.board = [];
                this.currentPlayer = 'red';
                this.selectedPiece = null;
                this.gameStarted = false;
                this.gameEnded = false;
                
                // åŠ¨ç‰©æ£‹å­å®šä¹‰
                this.animals = {
                    1: { name: 'é¼ ', emoji: 'ğŸ­', canSwim: true },
                    2: { name: 'çŒ«', emoji: 'ğŸ±', canSwim: false },
                    3: { name: 'ç‹—', emoji: 'ğŸ•', canSwim: false },
                    4: { name: 'ç‹¼', emoji: 'ğŸº', canSwim: false },
                    5: { name: 'è±¹', emoji: 'ğŸ†', canSwim: false },
                    6: { name: 'è™', emoji: 'ğŸ…', canJump: true },
                    7: { name: 'ç‹®', emoji: 'ğŸ¦', canJump: true },
                    8: { name: 'è±¡', emoji: 'ğŸ˜', canSwim: false }
                };
                
                this.initBoard();
                this.bindEvents();
                this.renderBoard();
                this.updatePieceCount();
            }

            initBoard() {
                // åˆå§‹åŒ–9x7çš„æ£‹ç›˜
                this.board = Array(9).fill(null).map(() => Array(7).fill(null));
                
                // è®¾ç½®åœ°å½¢
                this.setupTerrain();
                
                // æ”¾ç½®åŠ¨ç‰©
                this.setupAnimals();
            }

            setupTerrain() {
                // æ²³æµï¼ˆä¸­é—´3è¡Œä¸­é—´3åˆ—ï¼‰
                for (let row = 3; row <= 5; row++) {
                    for (let col = 1; col <= 2; col++) {
                        this.board[row][col] = { type: 'water' };
                    }
                    for (let col = 4; col <= 5; col++) {
                        this.board[row][col] = { type: 'water' };
                    }
                }
                
                // é™·é˜± - çº¢æ–¹é™·é˜±ï¼ˆä¸Šæ–¹ï¼‰
                this.board[0][2] = { type: 'trap', camp: 'red' };
                this.board[0][4] = { type: 'trap', camp: 'red' };
                this.board[1][3] = { type: 'trap', camp: 'red' };
                
                // é™·é˜± - è“æ–¹é™·é˜±ï¼ˆä¸‹æ–¹ï¼‰
                this.board[8][2] = { type: 'trap', camp: 'blue' };
                this.board[8][4] = { type: 'trap', camp: 'blue' };
                this.board[7][3] = { type: 'trap', camp: 'blue' };
                
                // å…½ç©´
                this.board[0][3] = { type: 'den', camp: 'red' };
                this.board[8][3] = { type: 'den', camp: 'blue' };
            }

            setupAnimals() {
                // çº¢æ–¹åŠ¨ç‰©ï¼ˆä¸Šæ–¹ï¼‰
                this.board[2][0] = { animal: { rank: 1, color: 'red', ...this.animals[1] } };
                this.board[1][1] = { animal: { rank: 2, color: 'red', ...this.animals[2] } };
                this.board[2][2] = { animal: { rank: 3, color: 'red', ...this.animals[3] } };
                this.board[1][5] = { animal: { rank: 4, color: 'red', ...this.animals[4] } };
                this.board[2][4] = { animal: { rank: 5, color: 'red', ...this.animals[5] } };
                this.board[0][0] = { animal: { rank: 6, color: 'red', ...this.animals[6] } };
                this.board[0][6] = { animal: { rank: 7, color: 'red', ...this.animals[7] } };
                this.board[2][6] = { animal: { rank: 8, color: 'red', ...this.animals[8] } };
                
                // è“æ–¹åŠ¨ç‰©ï¼ˆä¸‹æ–¹ï¼‰
                this.board[6][6] = { animal: { rank: 1, color: 'blue', ...this.animals[1] } };
                this.board[7][5] = { animal: { rank: 2, color: 'blue', ...this.animals[2] } };
                this.board[6][4] = { animal: { rank: 3, color: 'blue', ...this.animals[3] } };
                this.board[7][1] = { animal: { rank: 4, color: 'blue', ...this.animals[4] } };
                this.board[6][2] = { animal: { rank: 5, color: 'blue', ...this.animals[5] } };
                this.board[8][6] = { animal: { rank: 6, color: 'blue', ...this.animals[6] } };
                this.board[8][0] = { animal: { rank: 7, color: 'blue', ...this.animals[7] } };
                this.board[6][0] = { animal: { rank: 8, color: 'blue', ...this.animals[8] } };
            }

            bindEvents() {
                document.getElementById('startButton').addEventListener('click', () => {
                    this.startGame();
                });

                document.getElementById('resetButton').addEventListener('click', () => {
                    this.resetGame();
                });

                document.getElementById('rulesButton').addEventListener('click', () => {
                    this.showRules();
                });

                document.getElementById('chessBoard').addEventListener('click', (e) => {
                    if (e.target.closest('.chess-cell')) {
                        const cell = e.target.closest('.chess-cell');
                        const row = parseInt(cell.dataset.row);
                        const col = parseInt(cell.dataset.col);
                        this.handleCellClick(row, col);
                    }
                });
            }

            startGame() {
                this.gameStarted = true;
                this.gameEnded = false;
                this.currentPlayer = 'red';
                document.getElementById('startButton').style.display = 'none';
                this.showMessage('æ¸¸æˆå¼€å§‹ï¼çº¢æ–¹å…ˆè¡Œ', 'info');
                this.renderBoard();
            }

            resetGame() {
                this.gameStarted = false;
                this.gameEnded = false;
                this.selectedPiece = null;
                this.currentPlayer = 'red';
                this.initBoard();
                this.renderBoard();
                this.updatePieceCount();
                document.getElementById('startButton').style.display = 'inline-block';
                this.hideMessage();
            }

            handleCellClick(row, col) {
                if (!this.gameStarted || this.gameEnded) return;

                const cell = this.board[row][col];
                
                if (this.selectedPiece) {
                    // å°è¯•ç§»åŠ¨
                    this.attemptMove(this.selectedPiece.row, this.selectedPiece.col, row, col);
                } else if (cell?.animal && cell.animal.color === this.currentPlayer) {
                    // é€‰æ‹©åŠ¨ç‰©
                    this.selectPiece(row, col);
                }
            }

            selectPiece(row, col) {
                this.selectedPiece = { row, col };
                this.renderBoard();
                this.showPossibleMoves(row, col);
            }

            showPossibleMoves(row, col) {
                const moves = this.getPossibleMoves(row, col);
                moves.forEach(([r, c]) => {
                    const cell = document.querySelector(`[data-row="${r}"][data-col="${c}"]`);
                    if (cell) {
                        cell.classList.add('possible-move');
                    }
                });
            }

            getPossibleMoves(row, col) {
                const animal = this.board[row][col]?.animal;
                if (!animal) return [];

                const moves = [];
                const directions = [[-1, 0], [1, 0], [0, -1], [0, 1]]; // ä¸Šä¸‹å·¦å³

                // è™å’Œç‹®å¯ä»¥è·³è¿‡æ²³æµ
                if (animal.canJump) {
                    moves.push(...this.getJumpMoves(row, col));
                }

                // æ™®é€šç§»åŠ¨
                directions.forEach(([dr, dc]) => {
                    const newRow = row + dr;
                    const newCol = col + dc;
                    
                    if (this.isValidPosition(newRow, newCol)) {
                        const targetCell = this.board[newRow][newCol];
                        
                        // æ£€æŸ¥æ˜¯å¦å¯ä»¥ç§»åŠ¨åˆ°ç›®æ ‡ä½ç½®
                        if (this.canMoveTo(animal, targetCell, newRow, newCol)) {
                            moves.push([newRow, newCol]);
                        }
                    }
                });

                return moves;
            }

            getJumpMoves(row, col) {
                const moves = [];
                const animal = this.board[row][col]?.animal;
                
                if (!animal || !animal.canJump) return moves;

                // æ£€æŸ¥å‚ç›´è·³è·ƒ
                if (col >= 1 && col <= 2) { // å·¦ä¾§æ²³è¾¹
                    const landRow = row;
                    const landCol = 4; // è·³åˆ°å³ä¾§æ²³è¾¹
                    if (this.isValidPosition(landRow, landCol)) {
                        const targetCell = this.board[landRow][landCol];
                        if (this.canMoveTo(animal, targetCell, landRow, landCol)) {
                            moves.push([landRow, landCol]);
                        }
                    }
                } else if (col >= 4 && col <= 5) { // å³ä¾§æ²³è¾¹
                    const landRow = row;
                    const landCol = 1; // è·³åˆ°å·¦ä¾§æ²³è¾¹
                    if (this.isValidPosition(landRow, landCol)) {
                        const targetCell = this.board[landRow][landCol];
                        if (this.canMoveTo(animal, targetCell, landRow, landCol)) {
                            moves.push([landRow, landCol]);
                        }
                    }
                }

                // æ£€æŸ¥æ°´å¹³è·³è·ƒ
                if (row === 2) { // ä¸Šæ–¹æ²³è¾¹
                    const landRow = 6; // è·³åˆ°ä¸‹æ–¹æ²³è¾¹
                    const landCol = col;
                    if (this.isValidPosition(landRow, landCol)) {
                        const targetCell = this.board[landRow][landCol];
                        if (this.canMoveTo(animal, targetCell, landRow, landCol)) {
                            moves.push([landRow, landCol]);
                        }
                    }
                } else if (row === 6) { // ä¸‹æ–¹æ²³è¾¹
                    const landRow = 2; // è·³åˆ°ä¸Šæ–¹æ²³è¾¹
                    const landCol = col;
                    if (this.isValidPosition(landRow, landCol)) {
                        const targetCell = this.board[landRow][landCol];
                        if (this.canMoveTo(animal, targetCell, landRow, landCol)) {
                            moves.push([landRow, landCol]);
                        }
                    }
                }

                return moves;
            }

            canMoveTo(animal, targetCell, row, col) {
                // ä¸èƒ½è¿›å…¥å·±æ–¹å…½ç©´
                if (targetCell?.type === 'den' && targetCell.camp === animal.color) {
                    return false;
                }

                // åªæœ‰èƒ½æ¸¸æ³³çš„åŠ¨ç‰©å¯ä»¥è¿›å…¥æ°´ä¸­
                if (targetCell?.type === 'water' && !animal.canSwim) {
                    return false;
                }

                // å¯ä»¥ç§»åŠ¨åˆ°ç©ºä½
                if (!targetCell?.animal) {
                    return true;
                }

                // ä¸èƒ½æ”»å‡»å·±æ–¹åŠ¨ç‰©
                if (targetCell.animal.color === animal.color) {
                    return false;
                }

                // æ£€æŸ¥æ˜¯å¦å¯ä»¥æ”»å‡»å¯¹æ–¹åŠ¨ç‰©
                return this.canAttack(animal, targetCell.animal, targetCell);
            }

            canAttack(attacker, defender, defenderCell) {
                // åœ¨é™·é˜±ä¸­çš„åŠ¨ç‰©å¯ä»¥è¢«ä»»ä½•åŠ¨ç‰©æ”»å‡»
                if (defenderCell?.type === 'trap' && defenderCell.camp !== defender.color) {
                    return true;
                }

                // é¼ å¯ä»¥æ”»å‡»è±¡
                if (attacker.rank === 1 && defender.rank === 8) {
                    return true;
                }

                // è±¡ä¸èƒ½æ”»å‡»é¼ 
                if (attacker.rank === 8 && defender.rank === 1) {
                    return false;
                }

                // æ°´ä¸­çš„åŠ¨ç‰©åªèƒ½è¢«æ°´ä¸­çš„åŠ¨ç‰©æ”»å‡»
                if (defenderCell?.type === 'water' && !attacker.canSwim) {
                    return false;
                }

                // æ­£å¸¸æƒ…å†µï¼šç­‰çº§é«˜çš„æ”»å‡»ç­‰çº§ä½çš„
                return attacker.rank >= defender.rank;
            }

            attemptMove(fromRow, fromCol, toRow, toCol) {
                const animal = this.board[fromRow][fromCol]?.animal;
                const target = this.board[toRow][toCol];

                if (!animal) return;

                const possibleMoves = this.getPossibleMoves(fromRow, fromCol);
                const isValidMove = possibleMoves.some(([r, c]) => r === toRow && c === toCol);

                if (!isValidMove) {
                    this.showMessage('æ— æ•ˆç§»åŠ¨ï¼', 'error');
                    this.clearSelection();
                    return;
                }

                // æ£€æŸ¥æ˜¯å¦æ”»å‡»æ•Œæ–¹å…½ç©´
                if (target?.type === 'den' && target.camp !== animal.color) {
                    this.endGame(`${animal.color === 'red' ? 'çº¢æ–¹' : 'è“æ–¹'}èƒœåˆ©ï¼æˆåŠŸå é¢†æ•Œæ–¹å…½ç©´ï¼`);
                    return;
                }

                // å¤„ç†æˆ˜æ–—
                if (target?.animal) {
                    const battleResult = this.resolveBattle(animal, target.animal, target);
                    this.showMessage(battleResult.message, battleResult.type);
                    
                    if (battleResult.winner === animal) {
                        this.movePiece(fromRow, fromCol, toRow, toCol);
                    } else {
                        this.clearSelection();
                        this.switchPlayer();
                        return;
                    }
                } else {
                    this.movePiece(fromRow, fromCol, toRow, toCol);
                    this.showMessage(`${animal.emoji}${animal.name}ç§»åŠ¨åˆ°æ–°ä½ç½®`, 'info');
                }

                this.clearSelection();
                this.checkGameEnd();
                this.switchPlayer();
                this.updatePieceCount();
                this.renderBoard();
            }

            movePiece(fromRow, fromCol, toRow, toCol) {
                const animal = this.board[fromRow][fromCol].animal;
                const targetTerrain = this.board[toRow][toCol];
                
                this.board[toRow][toCol] = {
                    ...targetTerrain,
                    animal
                };
                
                // ä¿ç•™åŸä½ç½®çš„åœ°å½¢ä¿¡æ¯
                this.board[fromRow][fromCol] = {
                    ...this.board[fromRow][fromCol],
                    animal: null
                };
            }

            resolveBattle(attacker, defender, defenderCell) {
                const attackerName = `${attacker.emoji}${attacker.name}`;
                const defenderName = `${defender.emoji}${defender.name}`;

                if (this.canAttack(attacker, defender, defenderCell)) {
                    return {
                        winner: attacker,
                        message: `${attackerName}å‡»è´¥äº†${defenderName}ï¼`,
                        type: 'success'
                    };
                } else {
                    return {
                        winner: defender,
                        message: `${defenderName}å‡»é€€äº†${attackerName}ï¼`,
                        type: 'error'
                    };
                }
            }

            clearSelection() {
                this.selectedPiece = null;
                this.renderBoard();
            }

            switchPlayer() {
                this.currentPlayer = this.currentPlayer === 'red' ? 'blue' : 'red';
                document.getElementById('currentTurn').textContent = 
                    this.currentPlayer === 'red' ? 'çº¢æ–¹' : 'è“æ–¹';
            }

            checkGameEnd() {
                let redAnimals = 0, blueAnimals = 0;

                for (let row = 0; row < 9; row++) {
                    for (let col = 0; col < 7; col++) {
                        const animal = this.board[row][col]?.animal;
                        if (animal) {
                            if (animal.color === 'red') {
                                redAnimals++;
                            } else {
                                blueAnimals++;
                            }
                        }
                    }
                }

                if (redAnimals === 0) {
                    this.endGame('è“æ–¹èƒœåˆ©ï¼çº¢æ–¹åŠ¨ç‰©å…¨éƒ¨é˜µäº¡ï¼');
                } else if (blueAnimals === 0) {
                    this.endGame('çº¢æ–¹èƒœåˆ©ï¼è“æ–¹åŠ¨ç‰©å…¨éƒ¨é˜µäº¡ï¼');
                }
            }

            endGame(message) {
                this.gameEnded = true;
                this.showMessage(message, 'success');
                this.clearSelection();
            }

            showRules() {
                const rules = `
ğŸ¦ æ–—å…½æ£‹æ¸¸æˆè§„åˆ™ï¼š

ğŸ“‹ åŸºæœ¬è§„åˆ™ï¼š
â€¢ çº¢è“åŒæ–¹å„æœ‰8åªåŠ¨ç‰©
â€¢ ç›®æ ‡ï¼šå é¢†æ•Œæ–¹å…½ç©´æˆ–æ¶ˆç­æ•Œæ–¹æ‰€æœ‰åŠ¨ç‰©

ğŸ¾ åŠ¨ç‰©ç­‰çº§ï¼ˆä»å°åˆ°å¤§ï¼‰ï¼š
1. é¼  ğŸ­ - å¯æ¸¸æ³³ï¼Œå”¯ä¸€èƒ½å…‹åˆ¶è±¡çš„åŠ¨ç‰©
2. çŒ« ğŸ± - å…‹åˆ¶é¼ 
3. ç‹— ğŸ• - å…‹åˆ¶çŒ«
4. ç‹¼ ğŸº - å…‹åˆ¶ç‹—
5. è±¹ ğŸ† - å…‹åˆ¶ç‹¼
6. è™ ğŸ… - å…‹åˆ¶è±¹ï¼Œå¯è·³è¿‡æ²³æµ
7. ç‹® ğŸ¦ - å…‹åˆ¶è™ï¼Œå¯è·³è¿‡æ²³æµ
8. è±¡ ğŸ˜ - æœ€å¼ºä½†è¢«é¼ å…‹åˆ¶

ğŸ—ºï¸ åœ°å½¢è¯´æ˜ï¼š
â€¢ ğŸŒŠ æ²³æµï¼šåªæœ‰é¼ å¯ä»¥è¿›å…¥
â€¢ âš¡ é™·é˜±ï¼šæ•Œæ–¹åŠ¨ç‰©è¿›å…¥åå¤±å»æˆ˜æ–—åŠ›
â€¢ ğŸ  å…½ç©´ï¼šæ•Œæ–¹å é¢†å³è·èƒœ

âš”ï¸ æˆ˜æ–—è§„åˆ™ï¼š
â€¢ ç­‰çº§é«˜çš„åŠ¨ç‰©å¯ä»¥åƒæ‰ç­‰çº§ä½çš„åŠ¨ç‰©
â€¢ åŒç­‰çº§åŠ¨ç‰©ç›¸é‡ï¼Œæ”»å‡»æ–¹è·èƒœ
â€¢ åœ¨é™·é˜±ä¸­çš„åŠ¨ç‰©å¯è¢«ä»»ä½•æ•Œæ–¹åŠ¨ç‰©åƒæ‰
â€¢ è™å’Œç‹®å¯ä»¥è·³è¿‡æ²³æµ
                `;
                
                this.showMessage(rules, 'info');
            }

            isValidPosition(row, col) {
                return row >= 0 && row < 9 && col >= 0 && col < 7;
            }

            renderBoard() {
                const board = document.getElementById('chessBoard');
                board.innerHTML = '';

                for (let row = 0; row < 9; row++) {
                    for (let col = 0; col < 7; col++) {
                        const cell = document.createElement('div');
                        cell.className = 'chess-cell';
                        cell.dataset.row = row;
                        cell.dataset.col = col;

                        const cellData = this.board[row][col];
                        
                        // è®¾ç½®åœ°å½¢æ ·å¼
                        if (cellData?.type) {
                            cell.classList.add(cellData.type);
                        }

                        // æ˜¾ç¤ºåŠ¨ç‰©
                        if (cellData?.animal) {
                            const animal = cellData.animal;
                            const animalDiv = document.createElement('div');
                            animalDiv.className = `chess-piece ${animal.color}-piece`;
                            animalDiv.textContent = animal.emoji;
                            cell.appendChild(animalDiv);
                        }

                        // é«˜äº®é€‰ä¸­çš„åŠ¨ç‰©
                        if (this.selectedPiece && 
                            this.selectedPiece.row === row && 
                            this.selectedPiece.col === col) {
                            cell.classList.add('selected');
                        }

                        board.appendChild(cell);
                    }
                }
            }

            updatePieceCount() {
                let redCount = 0, blueCount = 0;

                for (let row = 0; row < 9; row++) {
                    for (let col = 0; col < 7; col++) {
                        const animal = this.board[row][col]?.animal;
                        if (animal) {
                            if (animal.color === 'red') {
                                redCount++;
                            } else {
                                blueCount++;
                            }
                        }
                    }
                }

                document.getElementById('redCount').textContent = redCount;
                document.getElementById('blueCount').textContent = blueCount;
            }

            showMessage(text, type) {
                const message = document.getElementById('message');
                message.textContent = text;
                message.className = `message ${type} show`;
            }

            hideMessage() {
                const message = document.getElementById('message');
                message.classList.remove('show');
            }
        }

        // å¯åŠ¨æ¸¸æˆ
        window.addEventListener('load', () => {
            new AnimalChess();
        });
    </script>
</body>
</html>