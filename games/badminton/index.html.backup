<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾½æ¯›çƒæ¸¸æˆ - ç»å…¸ç¾½æ¯›çƒå¯¹æˆ˜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 1000px;
            width: 100%;
        }

        .game-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .game-title {
            font-size: 2.5em;
            font-weight: 700;
            color: #2d3436;
            margin-bottom: 10px;
        }

        .game-subtitle {
            color: #636e72;
            font-size: 1.1em;
        }

        .game-canvas {
            border: 4px solid #2d3436;
            border-radius: 10px;
            display: block;
            margin: 0 auto;
            background: #00cec9;
            cursor: crosshair;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            font-weight: bold;
            color: #2d3436;
            font-size: 1.2em;
        }

        .player-score {
            color: #a29bfe;
        }

        .ai-score {
            color: #fd79a8;
        }

        .rally-count {
            color: #00b894;
            font-size: 1em;
        }

        .controls {
            text-align: center;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .controls h3 {
            color: #2d3436;
            margin-bottom: 15px;
        }

        .control-item {
            display: inline-block;
            margin: 5px 15px;
            padding: 8px 16px;
            background: #a29bfe;
            color: white;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .message {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            font-weight: bold;
            display: none;
        }

        .message.show {
            display: block;
        }

        .message.point {
            background: #55efc4;
            color: #2d3436;
        }

        .message.rally {
            background: #fdcb6e;
            color: #2d3436;
        }

        .message.game-over {
            background: #fd79a8;
            color: white;
        }

        .start-button {
            display: block;
            margin: 20px auto;
            padding: 12px 30px;
            background: #a29bfe;
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .start-button:hover {
            background: #6c5ce7;
            transform: translateY(-2px);
        }

        .power-indicator {
            text-align: center;
            margin: 15px 0;
        }

        .power-bar {
            width: 300px;
            height: 20px;
            background: #ddd;
            border-radius: 10px;
            margin: 10px auto;
            overflow: hidden;
            border: 2px solid #2d3436;
        }

        .power-fill {
            height: 100%;
            background: linear-gradient(90deg, #00b894, #fdcb6e, #e17055);
            width: 0%;
            transition: width 0.1s ease;
        }

        @media (max-width: 768px) {
            .game-container {
                padding: 20px;
                margin: 10px;
            }
            
            .game-canvas {
                width: 100%;
                height: auto;
            }

            .game-info {
                flex-wrap: wrap;
                gap: 10px;
                justify-content: center;
            }

            .power-bar {
                width: 250px;
            }

            .control-item {
                display: block;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1 class="game-title">ğŸ¸ ç¾½æ¯›çƒæ¸¸æˆ</h1>
            <p class="game-subtitle">ç»å…¸ç¾½æ¯›çƒå¯¹æˆ˜ - è½»ç›ˆé£ç¿”ï¼Œç²¾å‡†å‡»çƒï¼</p>
        </div>

        <div class="game-info">
            <div class="player-score">
                ç©å®¶: <span id="playerScore">0</span>
            </div>
            <div class="rally-count">
                å›åˆ: <span id="rallyCount">0</span>
            </div>
            <div class="ai-score">
                ç”µè„‘: <span id="aiScore">0</span>
            </div>
        </div>

        <div class="power-indicator">
            <div style="font-weight: bold; color: #2d3436; margin-bottom: 5px;">å‡»çƒåŠ›åº¦</div>
            <div class="power-bar">
                <div class="power-fill" id="powerFill"></div>
            </div>
        </div>

        <canvas id="gameCanvas" class="game-canvas" width="900" height="600"></canvas>

        <div class="message" id="message"></div>

        <button class="start-button" id="startButton">å¼€å§‹æ¯”èµ›</button>

        <div class="controls">
            <h3>ğŸ® æ¸¸æˆæ§åˆ¶</h3>
            <div class="control-item">é¼ æ ‡ç§»åŠ¨ - æ§åˆ¶çƒå‘˜ä½ç½®</div>
            <div class="control-item">æŒ‰ä½é¼ æ ‡ - è“„åŠ›å‡»çƒ</div>
            <div class="control-item">æ¾å¼€é¼ æ ‡ - å‡»çƒ</div>
            <div class="control-item">å…ˆå¾—21åˆ†è·èƒœ</div>
        </div>
    </div>

    <script>
        class BadmintonGame {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.canvas.width = 900;
                this.canvas.height = 600;
                
                this.gameState = 'menu';
                this.playerScore = 0;
                this.aiScore = 0;
                this.rallyCount = 0;
                this.winningScore = 21;
                
                this.mouse = { x: this.canvas.width / 2, y: this.canvas.height - 100 };
                this.isCharging = false;
                this.chargePower = 0;
                this.maxPower = 100;
                this.chargeSpeed = 2.5;
                
                this.shuttlecock = null;
                this.shuttlecockTrail = [];
                this.player = null;
                this.aiPlayer = null;
                
                this.net = {
                    x: this.canvas.width / 2 - 5,
                    y: this.canvas.height / 2 - 40,
                    width: 10,
                    height: 80
                };
                
                this.court = {
                    width: this.canvas.width - 40,
                    height: this.canvas.height - 40,
                    x: 20,
                    y: 20
                };
                
                this.initializeGame();
                this.bindEvents();
                this.updateUI();
            }

            initializeGame() {
                // åˆå§‹åŒ–ç¾½æ¯›çƒ
                this.shuttlecock = {
                    x: this.canvas.width / 2,
                    y: this.canvas.height - 150,
                    radius: 6,
                    vx: 0,
                    vy: 0,
                    gravity: 0.4,
                    airResistance: 0.98,
                    rotationAngle: 0,
                    rotationSpeed: 0.3,
                    color: '#f8f9fa',
                    isInPlay: false,
                    lastHit: 'serve',
                    hitCount: 0
                };
                
                // åˆå§‹åŒ–ç©å®¶
                this.player = {
                    x: this.canvas.width / 2,
                    y: this.canvas.height - 80,
                    radius: 18,
                    speed: 5,
                    color: '#a29bfe',
                    racketLength: 35,
                    racketAngle: 0,
                    isMoving: false
                };
                
                // åˆå§‹åŒ–AIçƒå‘˜
                this.aiPlayer = {
                    x: this.canvas.width / 2,
                    y: 80,
                    radius: 18,
                    speed: 4,
                    color: '#fd79a8',
                    racketLength: 35,
                    racketAngle: 0,
                    targetX: this.canvas.width / 2,
                    reactionTime: 0,
                    difficulty: 0.85
                };
                
                this.shuttlecockTrail = [];
                this.serveTurn = 'player';
                this.rallyCount = 0;
                this.resetForServe();
            }

            resetForServe() {
                if (this.serveTurn === 'player') {
                    this.shuttlecock.x = this.player.x;
                    this.shuttlecock.y = this.player.y - 40;
                } else {
                    this.shuttlecock.x = this.aiPlayer.x;
                    this.shuttlecock.y = this.aiPlayer.y + 40;
                }
                this.shuttlecock.vx = 0;
                this.shuttlecock.vy = 0;
                this.shuttlecock.isInPlay = false;
                this.shuttlecock.hitCount = 0;
                this.rallyCount = 0;
            }

            bindEvents() {
                document.getElementById('startButton').addEventListener('click', () => {
                    this.startGame();
                });
                
                this.canvas.addEventListener('mousemove', (e) => {
                    const rect = this.canvas.getBoundingClientRect();
                    this.mouse.x = e.clientX - rect.left;
                    this.mouse.y = e.clientY - rect.top;
                });
                
                this.canvas.addEventListener('mousedown', (e) => {
                    if (this.gameState === 'playing') {
                        this.isCharging = true;
                        this.chargePower = 0;
                    }
                });
                
                this.canvas.addEventListener('mouseup', (e) => {
                    if (this.gameState === 'playing' && this.isCharging) {
                        this.playerHitShuttlecock();
                        this.isCharging = false;
                        this.chargePower = 0;
                    }
                });
                
                this.canvas.addEventListener('mouseleave', (e) => {
                    if (this.isCharging) {
                        this.playerHitShuttlecock();
                        this.isCharging = false;
                        this.chargePower = 0;
                    }
                });
            }

            startGame() {
                this.gameState = 'playing';
                this.playerScore = 0;
                this.aiScore = 0;
                this.initializeGame();
                this.updateUI();
                this.hideMessage();
                document.getElementById('startButton').style.display = 'none';
                this.gameLoop();
            }

            gameLoop() {
                if (this.gameState === 'playing') {
                    this.update();
                    this.draw();
                    requestAnimationFrame(() => this.gameLoop());
                }
            }

            update() {
                this.updatePlayer();
                this.updateAI();
                this.updateShuttlecock();
                this.updatePowerBar();
                this.checkCollisions();
                this.checkBounds();
            }

            updatePlayer() {
                // ç©å®¶åªèƒ½åœ¨è‡ªå·±çš„åŠåœºç§»åŠ¨
                const minY = this.canvas.height / 2 + 15;
                const maxY = this.canvas.height - 60;
                
                const targetX = Math.max(50, Math.min(this.canvas.width - 50, this.mouse.x));
                const targetY = Math.max(minY, Math.min(maxY, this.mouse.y));
                
                // å¹³æ»‘ç§»åŠ¨
                const dx = targetX - this.player.x;
                const dy = targetY - this.player.y;
                
                if (Math.abs(dx) > 2 || Math.abs(dy) > 2) {
                    this.player.x += dx * 0.15;
                    this.player.y += dy * 0.15;
                    this.player.isMoving = true;
                } else {
                    this.player.isMoving = false;
                }
                
                // æ›´æ–°è“„åŠ›
                if (this.isCharging) {
                    this.chargePower += this.chargeSpeed;
                    if (this.chargePower > this.maxPower) {
                        this.chargePower = this.maxPower;
                    }
                }
                
                // è®¡ç®—çƒæ‹è§’åº¦
                if (this.shuttlecock.isInPlay) {
                    const dx = this.shuttlecock.x - this.player.x;
                    const dy = this.shuttlecock.y - this.player.y;
                    this.player.racketAngle = Math.atan2(dy, dx);
                }
            }

            updateAI() {
                // AIåªèƒ½åœ¨è‡ªå·±çš„åŠåœºç§»åŠ¨
                const minY = 60;
                const maxY = this.canvas.height / 2 - 15;
                
                // AIé¢„æµ‹ç¾½æ¯›çƒçš„ä½ç½®
                if (this.shuttlecock.isInPlay && this.shuttlecock.vy < 0) {
                    // ç¾½æ¯›çƒæœAIæ–¹å‘ç§»åŠ¨
                    const timeToReach = Math.abs((this.aiPlayer.y - this.shuttlecock.y) / this.shuttlecock.vy);
                    this.aiPlayer.targetX = this.shuttlecock.x + this.shuttlecock.vx * timeToReach;
                    this.aiPlayer.reactionTime = 15 + Math.random() * 10; // æ·»åŠ éšæœºååº”æ—¶é—´
                } else if (this.shuttlecock.isInPlay && this.shuttlecock.vy > 0) {
                    // ç¾½æ¯›çƒè¿œç¦»AIï¼Œè¿”å›ä¸­å¤®
                    this.aiPlayer.targetX = this.canvas.width / 2 + (Math.random() - 0.5) * 100;
                }
                
                // AIç§»åŠ¨
                const dx = this.aiPlayer.targetX - this.aiPlayer.x;
                if (Math.abs(dx) > 5) {
                    const direction = dx > 0 ? 1 : -1;
                    this.aiPlayer.x += direction * this.aiPlayer.speed;
                }
                
                this.aiPlayer.x = Math.max(50, Math.min(this.canvas.width - 50, this.aiPlayer.x));
                
                // è®¡ç®—AIçƒæ‹è§’åº¦
                if (this.shuttlecock.isInPlay) {
                    const dx = this.shuttlecock.x - this.aiPlayer.x;
                    const dy = this.shuttlecock.y - this.aiPlayer.y;
                    this.aiPlayer.racketAngle = Math.atan2(dy, dx);
                }
                
                // AIå‡»çƒ
                if (this.aiPlayer.reactionTime > 0) {
                    this.aiPlayer.reactionTime--;
                    if (this.aiPlayer.reactionTime === 0) {
                        this.aiHitShuttlecock();
                    }
                }
            }

            updateShuttlecock() {
                if (!this.shuttlecock.isInPlay) return;
                
                // ä¿å­˜è½¨è¿¹
                this.shuttlecockTrail.push({ 
                    x: this.shuttlecock.x, 
                    y: this.shuttlecock.y,
                    rotation: this.shuttlecock.rotationAngle 
                });
                if (this.shuttlecockTrail.length > 12) {
                    this.shuttlecockTrail.shift();
                }
                
                // æ›´æ–°ä½ç½®
                this.shuttlecock.x += this.shuttlecock.vx;
                this.shuttlecock.y += this.shuttlecock.vy;
                
                // åº”ç”¨é‡åŠ›å’Œç©ºæ°”é˜»åŠ›
                this.shuttlecock.vy += this.shuttlecock.gravity;
                this.shuttlecock.vx *= this.shuttlecock.airResistance;
                this.shuttlecock.vy *= this.shuttlecock.airResistance;
                
                // æ›´æ–°æ—‹è½¬
                this.shuttlecock.rotationAngle += this.shuttlecock.rotationSpeed;
                
                // åœ°é¢ç¢°æ’
                if (this.shuttlecock.y + this.shuttlecock.radius > this.canvas.height - 20) {
                    this.shuttlecock.y = this.canvas.height - 20 - this.shuttlecock.radius;
                    this.shuttlecock.vy = 0;
                    this.shuttlecock.vx *= 0.3;
                    
                    // æ£€æŸ¥æ˜¯å¦å¾—åˆ†
                    this.checkPointScored();
                }
            }

            playerHitShuttlecock() {
                const distance = this.getDistance(this.player, this.shuttlecock);
                if (distance < this.player.radius + this.shuttlecock.radius + this.player.racketLength) {
                    this.hitShuttlecock(this.player, 'player');
                }
            }

            aiHitShuttlecock() {
                const distance = this.getDistance(this.aiPlayer, this.shuttlecock);
                if (distance < this.aiPlayer.radius + this.shuttlecock.radius + this.aiPlayer.racketLength) {
                    this.hitShuttlecock(this.aiPlayer, 'ai');
                }
            }

            hitShuttlecock(player, playerType) {
                // å¢åŠ å‡»çƒæ¬¡æ•°
                this.shuttlecock.hitCount++;
                this.rallyCount++;
                
                // è®¡ç®—å‡»çƒæ–¹å‘å’ŒåŠ›åº¦
                if (playerType === 'player') {
                    // ç©å®¶å‡»çƒï¼šæ ¹æ®è“„åŠ›å’Œé¼ æ ‡ä½ç½®
                    const power = Math.max(0.3, this.chargePower / 100);
                    const baseVelocity = 6 + power * 8;
                    
                    // æœå¯¹æ–¹åŠåœºçš„è§’åº¦
                    const angle = Math.random() * Math.PI / 4 - Math.PI / 8; // Â±22.5åº¦éšæœº
                    
                    this.shuttlecock.vx = Math.cos(angle) * baseVelocity * (Math.random() > 0.5 ? 1 : -1);
                    this.shuttlecock.vy = -Math.abs(Math.sin(angle)) * baseVelocity - 3;
                } else {
                    // AIå‡»çƒï¼šæ™ºèƒ½ç­–ç•¥
                    const corners = [
                        { x: this.canvas.width * 0.15, y: this.canvas.height * 0.85 },
                        { x: this.canvas.width * 0.85, y: this.canvas.height * 0.85 },
                        { x: this.canvas.width * 0.3, y: this.canvas.height * 0.7 },
                        { x: this.canvas.width * 0.7, y: this.canvas.height * 0.7 }
                    ];
                    
                    // æ ¹æ®ç©å®¶ä½ç½®é€‰æ‹©æœ€è¿œçš„è§’è½
                    let bestTarget = corners[0];
                    let maxDistance = 0;
                    
                    corners.forEach(corner => {
                        const dist = Math.sqrt(
                            Math.pow(corner.x - this.player.x, 2) + 
                            Math.pow(corner.y - this.player.y, 2)
                        );
                        if (dist > maxDistance) {
                            maxDistance = dist;
                            bestTarget = corner;
                        }
                    });
                    
                    const dx = bestTarget.x - this.shuttlecock.x;
                    const dy = bestTarget.y - this.shuttlecock.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    const velocity = 8 + Math.random() * 4;
                    
                    this.shuttlecock.vx = (dx / distance) * velocity;
                    this.shuttlecock.vy = (dy / distance) * velocity + 1;
                }
                
                this.shuttlecock.isInPlay = true;
                this.shuttlecock.lastHit = playerType;
                this.shuttlecock.rotationSpeed = 0.2 + Math.random() * 0.3;
                
                // é‡ç½®AIååº”æ—¶é—´
                this.aiPlayer.reactionTime = 0;
                
                // æ˜¾ç¤ºè¿å‡»æ•°
                if (this.rallyCount > 5) {
                    this.showMessage(`ç²¾å½©å¯¹æ‹‰ï¼${this.rallyCount} å›åˆ`, 'rally');
                    setTimeout(() => this.hideMessage(), 1500);
                }
            }

            checkCollisions() {
                // ç½‘å­ç¢°æ’
                if (this.shuttlecock.x >= this.net.x - this.shuttlecock.radius && 
                    this.shuttlecock.x <= this.net.x + this.net.width + this.shuttlecock.radius &&
                    this.shuttlecock.y >= this.net.y && 
                    this.shuttlecock.y <= this.net.y + this.net.height) {
                    
                    // æ’ç½‘
                    this.shuttlecock.vx *= -0.3;
                    this.shuttlecock.vy *= 0.3;
                    this.checkPointScored();
                }
                
                // è¾¹ç•Œç¢°æ’
                if (this.shuttlecock.x - this.shuttlecock.radius <= this.court.x || 
                    this.shuttlecock.x + this.shuttlecock.radius >= this.court.x + this.court.width) {
                    this.shuttlecock.vx *= -0.6;
                    this.shuttlecock.x = Math.max(this.court.x + this.shuttlecock.radius, 
                                          Math.min(this.court.x + this.court.width - this.shuttlecock.radius, this.shuttlecock.x));
                }
            }

            checkBounds() {
                // ç¾½æ¯›çƒå‡ºç•Œæ£€æŸ¥
                if (this.shuttlecock.y > this.canvas.height + 50 || 
                    this.shuttlecock.x < -50 || 
                    this.shuttlecock.x > this.canvas.width + 50) {
                    this.checkPointScored();
                }
            }

            checkPointScored() {
                if (!this.shuttlecock.isInPlay) return;
                
                let winner = '';
                
                // åˆ¤æ–­å¾—åˆ†é€»è¾‘
                if (this.shuttlecock.y > this.canvas.height / 2) {
                    // ç¾½æ¯›çƒåœ¨ç©å®¶åŠåœº
                    if (this.shuttlecock.lastHit === 'ai') {
                        winner = 'ai';
                    } else {
                        winner = 'player';
                    }
                } else {
                    // ç¾½æ¯›çƒåœ¨AIåŠåœº
                    if (this.shuttlecock.lastHit === 'player') {
                        winner = 'player';
                    } else {
                        winner = 'ai';
                    }
                }
                
                this.scorePoint(winner);
            }

            scorePoint(winner) {
                if (winner === 'player') {
                    this.playerScore++;
                    this.showMessage('ç©å®¶å¾—åˆ†ï¼', 'point');
                } else {
                    this.aiScore++;
                    this.showMessage('ç”µè„‘å¾—åˆ†ï¼', 'point');
                }
                
                this.updateUI();
                
                // æ£€æŸ¥æ˜¯å¦è·èƒœ
                if (this.playerScore >= this.winningScore && this.playerScore - this.aiScore >= 2) {
                    this.endGame('player');
                } else if (this.aiScore >= this.winningScore && this.aiScore - this.playerScore >= 2) {
                    this.endGame('ai');
                } else {
                    // ç»§ç»­æ¯”èµ›
                    this.serveTurn = winner === 'player' ? 'player' : 'ai';
                    setTimeout(() => {
                        this.resetForServe();
                        this.hideMessage();
                    }, 2000);
                }
            }

            endGame(winner) {
                this.gameState = 'gameOver';
                
                let resultText;
                if (winner === 'player') {
                    resultText = `ğŸ‰ æ­å–œè·èƒœï¼æ¯”åˆ† ${this.playerScore}:${this.aiScore}`;
                } else {
                    resultText = `ğŸ˜” æ¯”èµ›å¤±è´¥ï¼æ¯”åˆ† ${this.playerScore}:${this.aiScore}`;
                }
                
                this.showMessage(resultText, 'game-over');
                document.getElementById('startButton').style.display = 'block';
                document.getElementById('startButton').textContent = 'é‡æ–°å¼€å§‹';
            }

            updatePowerBar() {
                const powerFill = document.getElementById('powerFill');
                const percentage = (this.chargePower / this.maxPower) * 100;
                powerFill.style.width = percentage + '%';
            }

            getDistance(obj1, obj2) {
                const dx = obj1.x - obj2.x;
                const dy = obj1.y - obj2.y;
                return Math.sqrt(dx * dx + dy * dy);
            }

            draw() {
                // æ¸…ç©ºç”»å¸ƒ
                this.ctx.fillStyle = '#00cec9';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // ç»˜åˆ¶çƒåœº
                this.drawCourt();
                
                // ç»˜åˆ¶ç½‘å­
                this.drawNet();
                
                // ç»˜åˆ¶çƒå‘˜
                this.drawPlayer(this.player);
                this.drawPlayer(this.aiPlayer);
                
                // ç»˜åˆ¶ç¾½æ¯›çƒè½¨è¿¹
                this.drawShuttlecockTrail();
                
                // ç»˜åˆ¶ç¾½æ¯›çƒ
                this.drawShuttlecock();
                
                // ç»˜åˆ¶è“„åŠ›æŒ‡ç¤ºå™¨
                if (this.isCharging) {
                    this.drawChargeIndicator();
                }
            }

            drawCourt() {
                // çƒåœºè¾¹ç•Œ
                this.ctx.strokeStyle = 'white';
                this.ctx.lineWidth = 3;
                this.ctx.strokeRect(this.court.x, this.court.y, this.court.width, this.court.height);
                
                // ä¸­çº¿
                this.ctx.beginPath();
                this.ctx.moveTo(this.court.x, this.canvas.height / 2);
                this.ctx.lineTo(this.court.x + this.court.width, this.canvas.height / 2);
                this.ctx.stroke();
                
                // å‘çƒçº¿
                const serviceLineY1 = this.canvas.height / 4;
                const serviceLineY2 = this.canvas.height * 3 / 4;
                
                this.ctx.beginPath();
                this.ctx.moveTo(this.court.x + 100, serviceLineY1);
                this.ctx.lineTo(this.court.x + this.court.width - 100, serviceLineY1);
                this.ctx.moveTo(this.court.x + 100, serviceLineY2);
                this.ctx.lineTo(this.court.x + this.court.width - 100, serviceLineY2);
                this.ctx.stroke();
                
                // ä¸­å¤®å‘çƒçº¿
                this.ctx.beginPath();
                this.ctx.moveTo(this.canvas.width / 2, serviceLineY1);
                this.ctx.lineTo(this.canvas.width / 2, serviceLineY2);
                this.ctx.stroke();
            }

            drawNet() {
                // ç½‘æŸ±
                this.ctx.fillStyle = '#2d3436';
                this.ctx.fillRect(this.net.x, this.net.y, this.net.width, this.net.height);
                
                // ç½‘å­çº¹ç†
                this.ctx.strokeStyle = 'white';
                this.ctx.lineWidth = 1;
                for (let i = 0; i < 8; i++) {
                    const y = this.net.y + (this.net.height / 8) * i;
                    this.ctx.beginPath();
                    this.ctx.moveTo(this.net.x, y);
                    this.ctx.lineTo(this.net.x + this.net.width, y);
                    this.ctx.stroke();
                }
                
                // å‚ç›´ç½‘çº¿
                for (let i = 0; i < 3; i++) {
                    const x = this.net.x + (this.net.width / 3) * i;
                    this.ctx.beginPath();
                    this.ctx.moveTo(x, this.net.y);
                    this.ctx.lineTo(x, this.net.y + this.net.height);
                    this.ctx.stroke();
                }
            }

            drawPlayer(player) {
                // çƒå‘˜é˜´å½±
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
                this.ctx.beginPath();
                this.ctx.ellipse(player.x, this.canvas.height - 15, player.radius, player.radius * 0.3, 0, 0, Math.PI * 2);
                this.ctx.fill();
                
                // çƒå‘˜èº«ä½“
                this.ctx.fillStyle = player.color;
                this.ctx.beginPath();
                this.ctx.arc(player.x, player.y, player.radius, 0, Math.PI * 2);
                this.ctx.fill();
                
                // çƒå‘˜è¾¹æ¡†
                this.ctx.strokeStyle = 'white';
                this.ctx.lineWidth = 3;
                this.ctx.beginPath();
                this.ctx.arc(player.x, player.y, player.radius, 0, Math.PI * 2);
                this.ctx.stroke();
                
                // çƒæ‹
                const racketX = player.x + Math.cos(player.racketAngle) * player.racketLength;
                const racketY = player.y + Math.sin(player.racketAngle) * player.racketLength;
                
                this.ctx.strokeStyle = '#8b4513';
                this.ctx.lineWidth = 6;
                this.ctx.beginPath();
                this.ctx.moveTo(player.x, player.y);
                this.ctx.lineTo(racketX, racketY);
                this.ctx.stroke();
                
                // çƒæ‹ç½‘é¢
                this.ctx.strokeStyle = 'white';
                this.ctx.lineWidth = 2;
                this.ctx.beginPath();
                this.ctx.arc(racketX, racketY, 12, 0, Math.PI * 2);
                this.ctx.stroke();
                
                // çƒæ‹ç½‘çº¿
                for (let i = -8; i <= 8; i += 4) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(racketX - 8, racketY + i);
                    this.ctx.lineTo(racketX + 8, racketY + i);
                    this.ctx.stroke();
                }
            }

            drawShuttlecockTrail() {
                for (let i = 0; i < this.shuttlecockTrail.length; i++) {
                    const alpha = (i + 1) / this.shuttlecockTrail.length * 0.4;
                    const size = (i + 1) / this.shuttlecockTrail.length * this.shuttlecock.radius;
                    
                    this.ctx.fillStyle = `rgba(248, 249, 250, ${alpha})`;
                    this.ctx.beginPath();
                    this.ctx.arc(this.shuttlecockTrail[i].x, this.shuttlecockTrail[i].y, size, 0, Math.PI * 2);
                    this.ctx.fill();
                }
            }

            drawShuttlecock() {
                this.ctx.save();
                this.ctx.translate(this.shuttlecock.x, this.shuttlecock.y);
                this.ctx.rotate(this.shuttlecock.rotationAngle);
                
                // ç¾½æ¯›çƒå¤´éƒ¨ï¼ˆçƒå¤´ï¼‰
                this.ctx.fillStyle = '#2d3436';
                this.ctx.beginPath();
                this.ctx.arc(0, 0, this.shuttlecock.radius, 0, Math.PI * 2);
                this.ctx.fill();
                
                // ç¾½æ¯›éƒ¨åˆ†
                this.ctx.strokeStyle = '#f8f9fa';
                this.ctx.lineWidth = 2;
                for (let i = 0; i < 8; i++) {
                    const angle = (Math.PI * 2 / 8) * i;
                    const startX = Math.cos(angle) * this.shuttlecock.radius;
                    const startY = Math.sin(angle) * this.shuttlecock.radius;
                    const endX = Math.cos(angle) * (this.shuttlecock.radius + 12);
                    const endY = Math.sin(angle) * (this.shuttlecock.radius + 12);
                    
                    this.ctx.beginPath();
                    this.ctx.moveTo(startX, startY);
                    this.ctx.lineTo(endX, endY);
                    this.ctx.stroke();
                }
                
                // ç¾½æ¯›çƒé«˜å…‰
                this.ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                this.ctx.beginPath();
                this.ctx.arc(-2, -2, this.shuttlecock.radius * 0.3, 0, Math.PI * 2);
                this.ctx.fill();
                
                this.ctx.restore();
            }

            drawChargeIndicator() {
                const centerX = this.player.x;
                const centerY = this.player.y - 50;
                const radius = 25;
                const percentage = this.chargePower / this.maxPower;
                
                // èƒŒæ™¯åœ†
                this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                this.ctx.lineWidth = 4;
                this.ctx.beginPath();
                this.ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                this.ctx.stroke();
                
                // è“„åŠ›åœ†
                this.ctx.strokeStyle = percentage > 0.8 ? '#e17055' : '#00b894';
                this.ctx.lineWidth = 4;
                this.ctx.beginPath();
                this.ctx.arc(centerX, centerY, radius, -Math.PI / 2, -Math.PI / 2 + Math.PI * 2 * percentage);
                this.ctx.stroke();
            }

            updateUI() {
                document.getElementById('playerScore').textContent = this.playerScore;
                document.getElementById('aiScore').textContent = this.aiScore;
                document.getElementById('rallyCount').textContent = this.rallyCount;
            }

            showMessage(text, type) {
                const message = document.getElementById('message');
                message.textContent = text;
                message.className = `message ${type} show`;
            }

            hideMessage() {
                const message = document.getElementById('message');
                message.classList.remove('show');
            }
        }

        // å¯åŠ¨æ¸¸æˆ
        window.addEventListener('load', () => {
            new BadmintonGame();
        });
    </script>
</body>
</html>