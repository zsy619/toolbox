# 纸牌接龙 (Klondike Solitaire)

## 游戏简介

经典的克朗代克纸牌接龙游戏，使用标准52张扑克牌。目标是将所有卡牌按花色从A到K依次放置到四个基础堆中。

## 游戏特色

### 🎮 完整的游戏体验
- **真实纸牌物理** - 流畅的拖拽系统和卡牌动画
- **经典克朗代克规则** - 严格按照传统规则实现
- **智能提示系统** - 分析当前局面给出最佳建议
- **自动完成功能** - 当所有移动都是显而易见时自动完成

### 🎯 操作方式
- **拖拽移动** - 鼠标拖拽卡牌到目标位置
- **点击选择** - 点击卡牌选中，再点击目标位置
- **双击快捷** - 双击卡牌自动移动到基础堆
- **序列移动** - 支持移动有效的卡牌序列

### 📊 统计系统
- **实时计分** - 移动到基础堆+10分，翻开卡牌+5分
- **计时功能** - 精确记录游戏时间
- **移动计数** - 统计总移动次数
- **胜率分析** - 长期游戏表现追踪

## 游戏规则

### 基本布局
```
[发牌堆] [废牌堆]    [♥️] [♦️] [♣️] [♠️]  (基础堆)
                    
[列1] [列2] [列3] [列4] [列5] [列6] [列7]  (工作区)
  1     2     3     4     5     6     7   (初始卡牌数)
```

### 游戏目标
将所有52张卡牌按花色分别放置到四个基础堆中，每个基础堆从A开始按升序排列到K。

### 移动规则

#### 基础堆 (Foundation)
- 必须从A开始按升序放置 (A, 2, 3, ..., J, Q, K)
- 每个花色一个基础堆
- 只能放置正确花色和数值的卡牌

#### 工作区 (Tableau)
- 可以放置比顶牌小1且颜色相反的卡牌
- 例如：红色6可以放在黑色7上
- 空列只能放置K
- 可以移动有效序列的多张卡牌

#### 发牌堆 (Stock)
- 点击发牌堆翻开3张牌到废牌堆
- 当发牌堆为空时，废牌堆重新洗回发牌堆

### 获胜条件
当所有四个基础堆都完成K时（每堆13张牌），游戏获胜。

## 技术实现

### 核心架构
```javascript
class Solitaire {
    // 游戏状态管理
    deck: []           // 完整牌组
    stock: []          // 发牌堆
    waste: []          // 废牌堆
    foundations: {}    // 四个基础堆
    tableau: []        // 七列工作区
    
    // 交互状态
    selectedCards: []  // 选中的卡牌
    isDragging: false  // 拖拽状态
    dragProxy: null    // 拖拽代理元素
}
```

### 拖拽系统
```javascript
// 开始拖拽
startDrag(cardEl, card, pileType, pileIndex, cardIndex, event)

// 拖拽移动
onMouseMove(event) 

// 结束拖拽
onMouseUp(event)

// 放置验证
canDropOn(dropTarget)
```

### 卡牌数据结构
```javascript
{
    suit: 'hearts',      // 花色
    value: 'A',          // 显示值
    rank: 1,             // 数值等级
    color: 'red',        // 颜色
    symbol: '♥️',         // 花色符号
    faceUp: true,        // 是否翻开
    id: 'hearts-A'       // 唯一标识
}
```

### 算法实现

#### 有效序列检查
```javascript
isValidSequence(cards) {
    for (let i = 1; i < cards.length; i++) {
        const prev = cards[i - 1];
        const curr = cards[i];
        
        // 检查颜色交替和数值递减
        if (prev.color === curr.color || 
            prev.rank !== curr.rank + 1) {
            return false;
        }
    }
    return true;
}
```

#### 自动完成算法
```javascript
autoComplete() {
    // 循环查找可移动到foundation的卡牌
    // 优先级：waste > tableau
    // 自动翻开隐藏卡牌
}
```

#### 智能提示系统
```javascript
findBestMove() {
    // 1. 检查可移动到foundation的卡牌
    // 2. 寻找可以翻开隐藏卡牌的移动
    // 3. 识别阻塞情况和解决方案
}
```

## 用户界面

### 响应式设计
- **桌面端** - 完整拖拽体验，悬停效果
- **平板端** - 触摸优化，放大卡牌
- **手机端** - 简化布局，手势支持

### 视觉反馈
- **拖拽预览** - 半透明卡牌跟随鼠标
- **放置提示** - 有效/无效放置区域高亮
- **动画效果** - 卡牌移动、翻转动画
- **胜利庆祝** - 完成时的特效展示

### 交互优化
- **防误操作** - 确认重要操作
- **批量移动** - 智能序列检测
- **快捷操作** - 键盘快捷键
- **撤销功能** - 历史移动记录

## 性能优化

### 渲染优化
- **DOM复用** - 最小化DOM操作
- **CSS3动画** - 硬件加速
- **事件委托** - 减少事件监听器
- **按需渲染** - 只更新变化部分

### 内存管理
- **对象池** - 复用卡牌对象
- **事件清理** - 及时移除监听器
- **弱引用** - 避免循环引用

## 扩展功能

### 游戏变体
- **Vegas模式** - 金钱计分系统
- **一次翻牌** - 只翻一张牌
- **时间限制** - 增加时间压力

### 统计分析
- **游戏历史** - 详细游戏记录
- **成功率** - 不同难度胜率
- **最佳时间** - 个人记录追踪

### 社交功能
- **每日挑战** - 固定牌局挑战
- **排行榜** - 全球玩家排名
- **成就系统** - 解锁特殊奖励

## 代码结构

```
solitaire/
├── index.html          # 游戏页面
├── css/
│   └── solitaire.css   # 样式文件
├── js/
│   └── solitaire.js    # 游戏逻辑
└── README.md           # 文档说明
```

## 浏览器兼容性

- ✅ Chrome 60+
- ✅ Firefox 55+
- ✅ Safari 12+
- ✅ Edge 79+
- ⚠️ IE 11 (部分功能)

## 使用说明

1. **启动游戏** - 打开 `index.html`
2. **发牌** - 点击左上角发牌堆
3. **移动卡牌** - 拖拽或点击选择
4. **获胜** - 完成四个基础堆

## 开发者说明

这个纸牌接龙实现注重用户体验和代码质量，采用面向对象设计，易于维护和扩展。所有功能都使用原生JavaScript实现，无需外部依赖。

### 主要类和方法
- `Solitaire` - 主游戏类
- `createDeck()` - 生成标准牌组
- `render()` - 渲染游戏界面
- `makeCardDraggable()` - 添加拖拽功能
- `canDropOn()` - 验证放置规则
- `autoComplete()` - 自动完成算法

游戏完全遵循克朗代克纸牌接龙的经典规则，提供了现代化的用户界面和流畅的交互体验。