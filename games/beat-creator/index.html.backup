<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŠ‚æ‹åˆ›ä½œ - Beat Creator | éŸ³ä¹åˆ¶ä½œæ¸¸æˆ</title>
    <meta name="description" content="åˆ›ä½œå±äºä½ çš„éŸ³ä¹èŠ‚æ‹ï¼è¿™æ˜¯ä¸€ä¸ªä¸“ä¸šçš„åœ¨çº¿èŠ‚æ‹åˆ¶ä½œå·¥å…·ï¼Œæ”¯æŒå¤šè½¨é“ç¼–è¾‘ã€å®æ—¶æ’­æ”¾å’ŒéŸ³æ•ˆè°ƒèŠ‚ã€‚">
    <meta name="keywords" content="èŠ‚æ‹åˆ›ä½œ,éŸ³ä¹åˆ¶ä½œ,Beat Creator,åœ¨çº¿éŸ³ä¹ç¼–è¾‘å™¨,èŠ‚å¥æ¸¸æˆ,éŸ³ä¹åˆ›ä½œå·¥å…·">
    <meta name="author" content="Game Creator">
    <meta property="og:title" content="èŠ‚æ‹åˆ›ä½œ - Beat Creator">
    <meta property="og:description" content="åˆ›ä½œå±äºä½ çš„éŸ³ä¹èŠ‚æ‹ï¼ä¸“ä¸šåœ¨çº¿èŠ‚æ‹åˆ¶ä½œå·¥å…·">
    <meta property="og:type" content="game">
    <link rel="canonical" href="/games/beat-creator/">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        .game-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            gap: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: white;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .controls-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .controls-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-group label {
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .btn {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(238, 90, 36, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(238, 90, 36, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.secondary {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
        }

        .btn.secondary:hover {
            box-shadow: 0 6px 20px rgba(78, 205, 196, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ff6b6b;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ff6b6b;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .tracks-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            flex: 1;
            overflow: auto;
        }

        .track {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            margin-bottom: 15px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .track:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        .track-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .track-title {
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .track-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .track-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .track-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .track-btn.active {
            background: #ff6b6b;
            border-color: #ff6b6b;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .volume-control input {
            width: 80px;
        }

        .sequencer {
            display: grid;
            grid-template-columns: repeat(16, 1fr);
            gap: 4px;
            margin-top: 10px;
        }

        .step {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .step:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .step.active {
            background: #ff6b6b;
            border-color: #ff6b6b;
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.5);
        }

        .step.playing {
            background: #4ecdc4;
            border-color: #4ecdc4;
            animation: pulse 0.2s ease-in-out;
        }

        .step.current {
            border-color: #ffd93d;
            border-width: 3px;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .transport-controls {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .pattern-controls {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .pattern-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .pattern-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .pattern-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .status-bar {
            background: rgba(0, 0, 0, 0.2);
            color: white;
            padding: 10px 20px;
            text-align: center;
            font-size: 0.9rem;
            border-radius: 0 0 20px 20px;
        }

        .recording {
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.5; }
        }

        @media (max-width: 768px) {
            .game-container {
                padding: 15px;
                gap: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .controls-row {
                grid-template-columns: 1fr;
            }

            .sequencer {
                grid-template-columns: repeat(8, 1fr);
            }

            .transport-controls {
                padding: 15px;
            }
        }

        .effects-panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            margin-top: 10px;
        }

        .effect-control {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .effect-control label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.85rem;
        }

        .effect-control input {
            width: 100px;
        }

        .performance-pad {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .pad {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            transition: all 0.2s ease;
            user-select: none;
        }

        .pad:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .pad:active {
            background: #ff6b6b;
            transform: scale(0.95);
        }

        .visualizer {
            height: 100px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            margin: 15px 0;
            overflow: hidden;
            position: relative;
        }

        .frequency-bar {
            position: absolute;
            bottom: 0;
            width: 4px;
            background: linear-gradient(to top, #ff6b6b, #4ecdc4, #ffd93d);
            border-radius: 2px 2px 0 0;
            transition: height 0.1s ease;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>ğŸµ èŠ‚æ‹åˆ›ä½œ</h1>
            <p>åˆ›ä½œå±äºä½ çš„éŸ³ä¹èŠ‚æ‹ï¼æ”¯æŒå¤šè½¨é“ç¼–è¾‘ã€å®æ—¶æ’­æ”¾å’Œä¸“ä¸šéŸ³æ•ˆè°ƒèŠ‚</p>
        </div>

        <div class="controls-panel">
            <div class="controls-row">
                <div class="control-group">
                    <label for="tempo">èŠ‚æ‹é€Ÿåº¦ (BPM)</label>
                    <input type="range" id="tempo" class="slider" min="60" max="200" value="120">
                    <span id="tempoValue">120 BPM</span>
                </div>
                <div class="control-group">
                    <label for="masterVolume">ä¸»éŸ³é‡</label>
                    <input type="range" id="masterVolume" class="slider" min="0" max="100" value="70">
                    <span id="volumeValue">70%</span>
                </div>
                <div class="control-group">
                    <label for="swing">æ‘‡æ‘†æ„Ÿ</label>
                    <input type="range" id="swing" class="slider" min="0" max="100" value="0">
                    <span id="swingValue">0%</span>
                </div>
            </div>
        </div>

        <div class="transport-controls">
            <button class="btn" id="playBtn">â–¶ï¸ æ’­æ”¾</button>
            <button class="btn secondary" id="stopBtn">â¹ï¸ åœæ­¢</button>
            <button class="btn secondary" id="recordBtn">ğŸ”´ å½•åˆ¶</button>
            <button class="btn secondary" id="clearBtn">ğŸ—‘ï¸ æ¸…ç©º</button>
            <button class="btn secondary" id="randomBtn">ğŸ² éšæœº</button>
        </div>

        <div class="tracks-container">
            <div class="track" data-track="kick">
                <div class="track-header">
                    <div class="track-title">
                        ğŸ¥ åº•é¼“ (Kick)
                    </div>
                    <div class="track-controls">
                        <button class="track-btn mute-btn">ğŸ”‡</button>
                        <button class="track-btn solo-btn">Solo</button>
                        <div class="volume-control">
                            <span>ğŸ”Š</span>
                            <input type="range" class="track-volume" min="0" max="100" value="80">
                        </div>
                    </div>
                </div>
                <div class="sequencer" data-track="kick"></div>
                <div class="effects-panel">
                    <div class="effect-control">
                        <label>éŸ³è°ƒ</label>
                        <input type="range" class="pitch-control" min="-12" max="12" value="0">
                    </div>
                    <div class="effect-control">
                        <label>æ··å“</label>
                        <input type="range" class="reverb-control" min="0" max="100" value="20">
                    </div>
                </div>
            </div>

            <div class="track" data-track="snare">
                <div class="track-header">
                    <div class="track-title">
                        ğŸ¯ å°é¼“ (Snare)
                    </div>
                    <div class="track-controls">
                        <button class="track-btn mute-btn">ğŸ”‡</button>
                        <button class="track-btn solo-btn">Solo</button>
                        <div class="volume-control">
                            <span>ğŸ”Š</span>
                            <input type="range" class="track-volume" min="0" max="100" value="75">
                        </div>
                    </div>
                </div>
                <div class="sequencer" data-track="snare"></div>
                <div class="effects-panel">
                    <div class="effect-control">
                        <label>éŸ³è°ƒ</label>
                        <input type="range" class="pitch-control" min="-12" max="12" value="0">
                    </div>
                    <div class="effect-control">
                        <label>æ··å“</label>
                        <input type="range" class="reverb-control" min="0" max="100" value="30">
                    </div>
                </div>
            </div>

            <div class="track" data-track="hihat">
                <div class="track-header">
                    <div class="track-title">
                        ğŸ© è¸©é•² (Hi-Hat)
                    </div>
                    <div class="track-controls">
                        <button class="track-btn mute-btn">ğŸ”‡</button>
                        <button class="track-btn solo-btn">Solo</button>
                        <div class="volume-control">
                            <span>ğŸ”Š</span>
                            <input type="range" class="track-volume" min="0" max="100" value="60">
                        </div>
                    </div>
                </div>
                <div class="sequencer" data-track="hihat"></div>
                <div class="effects-panel">
                    <div class="effect-control">
                        <label>éŸ³è°ƒ</label>
                        <input type="range" class="pitch-control" min="-12" max="12" value="0">
                    </div>
                    <div class="effect-control">
                        <label>æ»¤æ³¢</label>
                        <input type="range" class="filter-control" min="0" max="100" value="50">
                    </div>
                </div>
            </div>

            <div class="track" data-track="openhat">
                <div class="track-header">
                    <div class="track-title">
                        ğŸ”“ å¼€éŸ³è¸©é•² (Open Hat)
                    </div>
                    <div class="track-controls">
                        <button class="track-btn mute-btn">ğŸ”‡</button>
                        <button class="track-btn solo-btn">Solo</button>
                        <div class="volume-control">
                            <span>ğŸ”Š</span>
                            <input type="range" class="track-volume" min="0" max="100" value="50">
                        </div>
                    </div>
                </div>
                <div class="sequencer" data-track="openhat"></div>
                <div class="effects-panel">
                    <div class="effect-control">
                        <label>éŸ³è°ƒ</label>
                        <input type="range" class="pitch-control" min="-12" max="12" value="0">
                    </div>
                    <div class="effect-control">
                        <label>å»¶è¿Ÿ</label>
                        <input type="range" class="delay-control" min="0" max="100" value="0">
                    </div>
                </div>
            </div>

            <div class="track" data-track="clap">
                <div class="track-header">
                    <div class="track-title">
                        ğŸ‘ æ‹æ‰‹ (Clap)
                    </div>
                    <div class="track-controls">
                        <button class="track-btn mute-btn">ğŸ”‡</button>
                        <button class="track-btn solo-btn">Solo</button>
                        <div class="volume-control">
                            <span>ğŸ”Š</span>
                            <input type="range" class="track-volume" min="0" max="100" value="65">
                        </div>
                    </div>
                </div>
                <div class="sequencer" data-track="clap"></div>
                <div class="effects-panel">
                    <div class="effect-control">
                        <label>éŸ³è°ƒ</label>
                        <input type="range" class="pitch-control" min="-12" max="12" value="0">
                    </div>
                    <div class="effect-control">
                        <label>å¤±çœŸ</label>
                        <input type="range" class="distortion-control" min="0" max="100" value="10">
                    </div>
                </div>
            </div>

            <div class="track" data-track="crash">
                <div class="track-header">
                    <div class="track-title">
                        ğŸ’¥ é•²ç‰‡ (Crash)
                    </div>
                    <div class="track-controls">
                        <button class="track-btn mute-btn">ğŸ”‡</button>
                        <button class="track-btn solo-btn">Solo</button>
                        <div class="volume-control">
                            <span>ğŸ”Š</span>
                            <input type="range" class="track-volume" min="0" max="100" value="70">
                        </div>
                    </div>
                </div>
                <div class="sequencer" data-track="crash"></div>
                <div class="effects-panel">
                    <div class="effect-control">
                        <label>éŸ³è°ƒ</label>
                        <input type="range" class="pitch-control" min="-12" max="12" value="0">
                    </div>
                    <div class="effect-control">
                        <label>æ··å“</label>
                        <input type="range" class="reverb-control" min="0" max="100" value="60">
                    </div>
                </div>
            </div>
        </div>

        <div class="pattern-controls">
            <h3 style="color: white; margin-bottom: 15px;">ğŸ¼ é¢„è®¾èŠ‚æ‹æ¨¡å¼</h3>
            <div class="pattern-buttons">
                <button class="pattern-btn" data-pattern="basic">åŸºç¡€èŠ‚æ‹</button>
                <button class="pattern-btn" data-pattern="rock">æ‘‡æ»šèŠ‚æ‹</button>
                <button class="pattern-btn" data-pattern="funk">æ”¾å…‹èŠ‚æ‹</button>
                <button class="pattern-btn" data-pattern="disco">è¿ªæ–¯ç§‘</button>
                <button class="pattern-btn" data-pattern="techno">ç”µå­éŸ³ä¹</button>
                <button class="pattern-btn" data-pattern="jazz">çˆµå£«èŠ‚æ‹</button>
                <button class="pattern-btn" data-pattern="latin">æ‹‰ä¸èŠ‚æ‹</button>
                <button class="pattern-btn" data-pattern="trap">é™·é˜±éŸ³ä¹</button>
            </div>
        </div>

        <div class="pattern-controls">
            <h3 style="color: white; margin-bottom: 15px;">ğŸ¹ å®æ—¶æ¼”å¥é¢æ¿</h3>
            <div class="performance-pad">
                <div class="pad" data-sound="kick">Kick</div>
                <div class="pad" data-sound="snare">Snare</div>
                <div class="pad" data-sound="hihat">Hi-Hat</div>
                <div class="pad" data-sound="openhat">Open</div>
                <div class="pad" data-sound="clap">Clap</div>
                <div class="pad" data-sound="crash">Crash</div>
                <div class="pad" data-sound="ride">Ride</div>
                <div class="pad" data-sound="tom">Tom</div>
            </div>
            <div class="visualizer" id="visualizer"></div>
        </div>
    </div>

    <div class="status-bar" id="statusBar">
        å‡†å¤‡å°±ç»ª - å¼€å§‹åˆ›ä½œä½ çš„èŠ‚æ‹ï¼
    </div>

    <script>
        class BeatCreator {
            constructor() {
                this.audioContext = null;
                this.isPlaying = false;
                this.isRecording = false;
                this.currentStep = 0;
                this.tempo = 120;
                this.masterVolume = 0.7;
                this.swing = 0;
                this.stepTimer = null;
                this.stepDuration = (60 / this.tempo / 4) * 1000;
                
                this.tracks = {
                    kick: { steps: new Array(16).fill(false), volume: 0.8, muted: false, solo: false, effects: {} },
                    snare: { steps: new Array(16).fill(false), volume: 0.75, muted: false, solo: false, effects: {} },
                    hihat: { steps: new Array(16).fill(false), volume: 0.6, muted: false, solo: false, effects: {} },
                    openhat: { steps: new Array(16).fill(false), volume: 0.5, muted: false, solo: false, effects: {} },
                    clap: { steps: new Array(16).fill(false), volume: 0.65, muted: false, solo: false, effects: {} },
                    crash: { steps: new Array(16).fill(false), volume: 0.7, muted: false, solo: false, effects: {} }
                };

                this.patterns = {
                    basic: {
                        kick: [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],
                        snare: [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],
                        hihat: [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
                    },
                    rock: {
                        kick: [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0],
                        snare: [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],
                        hihat: [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0],
                        crash: [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0]
                    },
                    funk: {
                        kick: [1,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0],
                        snare: [0,0,1,0,0,1,1,0,0,0,1,0,0,1,1,0],
                        hihat: [1,1,0,1,1,0,1,1,1,1,0,1,1,0,1,1]
                    },
                    disco: {
                        kick: [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0],
                        snare: [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],
                        hihat: [1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1],
                        openhat: [0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1]
                    },
                    techno: {
                        kick: [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],
                        snare: [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],
                        hihat: [0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],
                        openhat: [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0]
                    },
                    jazz: {
                        kick: [1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0],
                        snare: [0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0],
                        hihat: [1,0,1,1,0,1,1,0,1,0,1,1,0,1,1,0],
                        crash: [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
                    },
                    latin: {
                        kick: [1,0,0,1,0,1,0,0,1,0,1,0,0,1,0,0],
                        snare: [0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0],
                        hihat: [1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1],
                        clap: [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0]
                    },
                    trap: {
                        kick: [1,0,0,0,0,0,1,0,0,1,0,0,0,0,1,0],
                        snare: [0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1],
                        hihat: [1,0,1,1,0,1,1,0,1,0,1,1,0,1,1,0],
                        clap: [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0]
                    }
                };

                this.sounds = {};
                this.analyser = null;
                this.dataArray = null;
                this.recordedPattern = [];
                
                this.init();
            }

            async init() {
                await this.initAudio();
                this.createSequencers();
                this.setupControls();
                this.setupKeyboardControls();
                this.setupVisualizer();
                this.loadSavedPattern();
                this.updateStatus('å‡†å¤‡å°±ç»ª - å¼€å§‹åˆ›ä½œä½ çš„èŠ‚æ‹ï¼');
            }

            async initAudio() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    this.masterGain = this.audioContext.createGain();
                    this.masterGain.connect(this.audioContext.destination);
                    this.masterGain.gain.value = this.masterVolume;

                    this.analyser = this.audioContext.createAnalyser();
                    this.analyser.fftSize = 128;
                    this.masterGain.connect(this.analyser);
                    this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);

                    await this.createSounds();
                } catch (error) {
                    console.error('éŸ³é¢‘åˆå§‹åŒ–å¤±è´¥:', error);
                    this.updateStatus('éŸ³é¢‘åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨è®¾ç½®');
                }
            }

            async createSounds() {
                const soundDefinitions = {
                    kick: { frequency: 60, type: 'sine', duration: 0.5, envelope: [0, 1, 0.3, 0] },
                    snare: { frequency: 200, type: 'square', duration: 0.2, envelope: [0, 1, 0.1, 0], noise: true },
                    hihat: { frequency: 8000, type: 'square', duration: 0.1, envelope: [0, 1, 0, 0], noise: true },
                    openhat: { frequency: 6000, type: 'square', duration: 0.3, envelope: [0, 1, 0.2, 0], noise: true },
                    clap: { frequency: 1000, type: 'square', duration: 0.15, envelope: [0, 1, 0.1, 0], noise: true },
                    crash: { frequency: 5000, type: 'square', duration: 1.0, envelope: [0, 1, 0.5, 0], noise: true },
                    ride: { frequency: 3000, type: 'triangle', duration: 0.8, envelope: [0, 1, 0.4, 0], noise: true },
                    tom: { frequency: 120, type: 'sine', duration: 0.4, envelope: [0, 1, 0.2, 0] }
                };

                this.sounds = {};
                for (const [name, def] of Object.entries(soundDefinitions)) {
                    this.sounds[name] = def;
                }
            }

            createSequencers() {
                Object.keys(this.tracks).forEach(trackName => {
                    const sequencer = document.querySelector(`.sequencer[data-track="${trackName}"]`);
                    if (sequencer) {
                        sequencer.innerHTML = '';
                        for (let i = 0; i < 16; i++) {
                            const step = document.createElement('div');
                            step.className = 'step';
                            step.dataset.step = i;
                            step.addEventListener('click', () => this.toggleStep(trackName, i));
                            sequencer.appendChild(step);
                        }
                    }
                });
            }

            setupControls() {
                // æ’­æ”¾æ§åˆ¶
                document.getElementById('playBtn').addEventListener('click', () => this.togglePlayback());
                document.getElementById('stopBtn').addEventListener('click', () => this.stop());
                document.getElementById('recordBtn').addEventListener('click', () => this.toggleRecording());
                document.getElementById('clearBtn').addEventListener('click', () => this.clearPattern());
                document.getElementById('randomBtn').addEventListener('click', () => this.generateRandomPattern());

                // ä¸»æ§åˆ¶
                const tempoSlider = document.getElementById('tempo');
                const masterVolumeSlider = document.getElementById('masterVolume');
                const swingSlider = document.getElementById('swing');

                tempoSlider.addEventListener('input', (e) => {
                    this.tempo = parseInt(e.target.value);
                    this.stepDuration = (60 / this.tempo / 4) * 1000;
                    document.getElementById('tempoValue').textContent = `${this.tempo} BPM`;
                    this.updateStatus(`èŠ‚æ‹é€Ÿåº¦: ${this.tempo} BPM`);
                });

                masterVolumeSlider.addEventListener('input', (e) => {
                    this.masterVolume = e.target.value / 100;
                    if (this.masterGain) {
                        this.masterGain.gain.value = this.masterVolume;
                    }
                    document.getElementById('volumeValue').textContent = `${e.target.value}%`;
                });

                swingSlider.addEventListener('input', (e) => {
                    this.swing = e.target.value / 100;
                    document.getElementById('swingValue').textContent = `${e.target.value}%`;
                });

                // è½¨é“æ§åˆ¶
                document.querySelectorAll('.mute-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const track = e.target.closest('.track').dataset.track;
                        this.toggleMute(track);
                    });
                });

                document.querySelectorAll('.solo-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const track = e.target.closest('.track').dataset.track;
                        this.toggleSolo(track);
                    });
                });

                document.querySelectorAll('.track-volume').forEach(slider => {
                    slider.addEventListener('input', (e) => {
                        const track = e.target.closest('.track').dataset.track;
                        this.tracks[track].volume = e.target.value / 100;
                    });
                });

                // é¢„è®¾æ¨¡å¼
                document.querySelectorAll('.pattern-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const pattern = e.target.dataset.pattern;
                        this.loadPattern(pattern);
                    });
                });

                // å®æ—¶æ¼”å¥é¢æ¿
                document.querySelectorAll('.pad').forEach(pad => {
                    pad.addEventListener('mousedown', (e) => {
                        const sound = e.target.dataset.sound;
                        this.playSound(sound);
                        if (this.isRecording) {
                            this.recordNote(sound);
                        }
                    });
                });

                // éŸ³æ•ˆæ§åˆ¶
                document.querySelectorAll('.pitch-control, .reverb-control, .filter-control, .delay-control, .distortion-control').forEach(control => {
                    control.addEventListener('input', (e) => {
                        const track = e.target.closest('.track').dataset.track;
                        const effectType = e.target.className.replace('-control', '').replace('pitch', 'pitch').replace('reverb', 'reverb').replace('filter', 'filter').replace('delay', 'delay').replace('distortion', 'distortion');
                        this.tracks[track].effects[effectType] = e.target.value;
                    });
                });
            }

            setupKeyboardControls() {
                const keyMap = {
                    'KeyQ': 'kick',
                    'KeyW': 'snare',
                    'KeyE': 'hihat',
                    'KeyR': 'openhat',
                    'KeyA': 'clap',
                    'KeyS': 'crash',
                    'KeyD': 'ride',
                    'KeyF': 'tom',
                    'Space': 'play'
                };

                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space') {
                        e.preventDefault();
                        this.togglePlayback();
                        return;
                    }

                    const sound = keyMap[e.code];
                    if (sound && !e.repeat) {
                        this.playSound(sound);
                        if (this.isRecording) {
                            this.recordNote(sound);
                        }
                        
                        const pad = document.querySelector(`[data-sound="${sound}"]`);
                        if (pad) {
                            pad.style.background = '#ff6b6b';
                            setTimeout(() => {
                                pad.style.background = '';
                            }, 150);
                        }
                    }
                });
            }

            setupVisualizer() {
                const visualizer = document.getElementById('visualizer');
                const bars = 32;
                
                for (let i = 0; i < bars; i++) {
                    const bar = document.createElement('div');
                    bar.className = 'frequency-bar';
                    bar.style.left = `${(i / bars) * 100}%`;
                    visualizer.appendChild(bar);
                }

                this.updateVisualizer();
            }

            updateVisualizer() {
                if (this.analyser && this.dataArray) {
                    this.analyser.getByteFrequencyData(this.dataArray);
                    const bars = document.querySelectorAll('.frequency-bar');
                    
                    bars.forEach((bar, index) => {
                        const value = this.dataArray[index * 2] || 0;
                        const height = (value / 255) * 100;
                        bar.style.height = `${height}%`;
                    });
                }
                
                requestAnimationFrame(() => this.updateVisualizer());
            }

            toggleStep(track, step) {
                this.tracks[track].steps[step] = !this.tracks[track].steps[step];
                this.updateSequencerDisplay();
                this.savePattern();
                
                const stepElement = document.querySelector(`.sequencer[data-track="${track}"] .step[data-step="${step}"]`);
                if (stepElement) {
                    stepElement.classList.toggle('active', this.tracks[track].steps[step]);
                }
            }

            updateSequencerDisplay() {
                Object.keys(this.tracks).forEach(trackName => {
                    const steps = document.querySelectorAll(`.sequencer[data-track="${trackName}"] .step`);
                    steps.forEach((step, index) => {
                        step.classList.toggle('active', this.tracks[trackName].steps[index]);
                        step.classList.toggle('current', index === this.currentStep);
                    });
                });
            }

            async togglePlayback() {
                if (!this.audioContext) {
                    await this.initAudio();
                }

                if (this.audioContext.state === 'suspended') {
                    await this.audioContext.resume();
                }

                if (this.isPlaying) {
                    this.pause();
                } else {
                    this.play();
                }
            }

            play() {
                this.isPlaying = true;
                document.getElementById('playBtn').textContent = 'â¸ï¸ æš‚åœ';
                this.updateStatus('æ­£åœ¨æ’­æ”¾...');
                
                this.stepTimer = setInterval(() => {
                    this.step();
                }, this.stepDuration);
            }

            pause() {
                this.isPlaying = false;
                document.getElementById('playBtn').textContent = 'â–¶ï¸ æ’­æ”¾';
                this.updateStatus('å·²æš‚åœ');
                
                if (this.stepTimer) {
                    clearInterval(this.stepTimer);
                    this.stepTimer = null;
                }
            }

            stop() {
                this.pause();
                this.currentStep = 0;
                this.updateSequencerDisplay();
                this.updateStatus('å·²åœæ­¢');
            }

            step() {
                const currentTime = this.audioContext.currentTime;
                
                Object.keys(this.tracks).forEach(trackName => {
                    const track = this.tracks[trackName];
                    if (track.steps[this.currentStep] && !track.muted) {
                        const shouldPlay = this.getSoloState() ? track.solo : true;
                        if (shouldPlay) {
                            this.playSound(trackName, currentTime);
                        }
                    }
                });

                this.currentStep = (this.currentStep + 1) % 16;
                this.updateSequencerDisplay();

                // æ·»åŠ å½“å‰æ­¥éª¤çš„è§†è§‰åé¦ˆ
                document.querySelectorAll('.step.current').forEach(el => el.classList.remove('current'));
                document.querySelectorAll(`.step[data-step="${this.currentStep}"]`).forEach(el => el.classList.add('current'));
            }

            playSound(soundName, when = 0) {
                if (!this.audioContext || !this.sounds[soundName]) return;

                const sound = this.sounds[soundName];
                const startTime = when || this.audioContext.currentTime;
                
                try {
                    if (sound.noise) {
                        this.playNoiseSound(soundName, startTime);
                    } else {
                        this.playToneSound(soundName, startTime);
                    }
                } catch (error) {
                    console.error('æ’­æ”¾å£°éŸ³å¤±è´¥:', error);
                }
            }

            playToneSound(soundName, startTime) {
                const sound = this.sounds[soundName];
                const track = this.tracks[soundName];
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.type = sound.type;
                oscillator.frequency.setValueAtTime(sound.frequency, startTime);
                
                // åº”ç”¨éŸ³è°ƒæ•ˆæœ
                if (track && track.effects.pitch) {
                    const pitchRatio = Math.pow(2, track.effects.pitch / 12);
                    oscillator.frequency.value *= pitchRatio;
                }
                
                gainNode.gain.setValueAtTime(0, startTime);
                gainNode.gain.linearRampToValueAtTime(track ? track.volume : 0.5, startTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + sound.duration);
                
                oscillator.connect(gainNode);
                gainNode.connect(this.masterGain);
                
                oscillator.start(startTime);
                oscillator.stop(startTime + sound.duration);
            }

            playNoiseSound(soundName, startTime) {
                const sound = this.sounds[soundName];
                const track = this.tracks[soundName];
                
                const bufferSize = this.audioContext.sampleRate * sound.duration;
                const buffer = this.audioContext.createBuffer(1, bufferSize, this.audioContext.sampleRate);
                const output = buffer.getChannelData(0);
                
                for (let i = 0; i < bufferSize; i++) {
                    output[i] = Math.random() * 2 - 1;
                }
                
                const noise = this.audioContext.createBufferSource();
                const gainNode = this.audioContext.createGain();
                const filter = this.audioContext.createBiquadFilter();
                
                noise.buffer = buffer;
                filter.type = 'bandpass';
                filter.frequency.value = sound.frequency;
                filter.Q.value = 5;
                
                // åº”ç”¨æ»¤æ³¢æ•ˆæœ
                if (track && track.effects.filter !== undefined) {
                    filter.frequency.value = sound.frequency * (track.effects.filter / 50);
                }
                
                gainNode.gain.setValueAtTime(0, startTime);
                gainNode.gain.linearRampToValueAtTime(track ? track.volume : 0.5, startTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + sound.duration);
                
                noise.connect(filter);
                filter.connect(gainNode);
                gainNode.connect(this.masterGain);
                
                noise.start(startTime);
                noise.stop(startTime + sound.duration);
            }

            toggleMute(track) {
                this.tracks[track].muted = !this.tracks[track].muted;
                const btn = document.querySelector(`[data-track="${track}"] .mute-btn`);
                btn.classList.toggle('active', this.tracks[track].muted);
                btn.textContent = this.tracks[track].muted ? 'ğŸ”ˆ' : 'ğŸ”‡';
                this.updateStatus(`${track} ${this.tracks[track].muted ? 'å·²é™éŸ³' : 'å–æ¶ˆé™éŸ³'}`);
            }

            toggleSolo(track) {
                this.tracks[track].solo = !this.tracks[track].solo;
                const btn = document.querySelector(`[data-track="${track}"] .solo-btn`);
                btn.classList.toggle('active', this.tracks[track].solo);
                this.updateStatus(`${track} ${this.tracks[track].solo ? 'ç‹¬å¥æ¨¡å¼' : 'å–æ¶ˆç‹¬å¥'}`);
            }

            getSoloState() {
                return Object.values(this.tracks).some(track => track.solo);
            }

            toggleRecording() {
                this.isRecording = !this.isRecording;
                const btn = document.getElementById('recordBtn');
                const statusBar = document.getElementById('statusBar');
                
                if (this.isRecording) {
                    btn.textContent = 'â¹ï¸ åœæ­¢å½•åˆ¶';
                    btn.classList.add('recording');
                    statusBar.classList.add('recording');
                    this.recordedPattern = [];
                    this.updateStatus('ğŸ”´ æ­£åœ¨å½•åˆ¶...');
                } else {
                    btn.textContent = 'ğŸ”´ å½•åˆ¶';
                    btn.classList.remove('recording');
                    statusBar.classList.remove('recording');
                    this.updateStatus('å½•åˆ¶å·²åœæ­¢');
                }
            }

            recordNote(sound) {
                if (this.isRecording) {
                    this.recordedPattern.push({
                        sound: sound,
                        time: Date.now(),
                        step: this.currentStep
                    });
                }
            }

            clearPattern() {
                Object.keys(this.tracks).forEach(track => {
                    this.tracks[track].steps.fill(false);
                });
                this.updateSequencerDisplay();
                this.savePattern();
                this.updateStatus('èŠ‚æ‹å·²æ¸…ç©º');
            }

            generateRandomPattern() {
                const densities = { kick: 0.3, snare: 0.25, hihat: 0.6, openhat: 0.15, clap: 0.2, crash: 0.1 };
                
                Object.keys(this.tracks).forEach(track => {
                    const density = densities[track] || 0.3;
                    for (let i = 0; i < 16; i++) {
                        this.tracks[track].steps[i] = Math.random() < density;
                    }
                });
                
                this.updateSequencerDisplay();
                this.savePattern();
                this.updateStatus('å·²ç”ŸæˆéšæœºèŠ‚æ‹æ¨¡å¼');
            }

            loadPattern(patternName) {
                const pattern = this.patterns[patternName];
                if (!pattern) return;

                Object.keys(pattern).forEach(track => {
                    if (this.tracks[track]) {
                        this.tracks[track].steps = [...pattern[track]];
                    }
                });

                this.updateSequencerDisplay();
                this.savePattern();
                this.updateStatus(`å·²åŠ è½½ ${patternName} èŠ‚æ‹æ¨¡å¼`);
            }

            savePattern() {
                const pattern = {
                    tracks: this.tracks,
                    tempo: this.tempo,
                    masterVolume: this.masterVolume,
                    swing: this.swing
                };
                localStorage.setItem('beatCreatorPattern', JSON.stringify(pattern));
            }

            loadSavedPattern() {
                const saved = localStorage.getItem('beatCreatorPattern');
                if (saved) {
                    try {
                        const pattern = JSON.parse(saved);
                        this.tracks = { ...this.tracks, ...pattern.tracks };
                        this.tempo = pattern.tempo || 120;
                        this.masterVolume = pattern.masterVolume || 0.7;
                        this.swing = pattern.swing || 0;
                        
                        document.getElementById('tempo').value = this.tempo;
                        document.getElementById('tempoValue').textContent = `${this.tempo} BPM`;
                        document.getElementById('masterVolume').value = this.masterVolume * 100;
                        document.getElementById('volumeValue').textContent = `${Math.round(this.masterVolume * 100)}%`;
                        document.getElementById('swing').value = this.swing * 100;
                        document.getElementById('swingValue').textContent = `${Math.round(this.swing * 100)}%`;
                        
                        this.updateSequencerDisplay();
                        this.updateStatus('å·²åŠ è½½ä¿å­˜çš„èŠ‚æ‹æ¨¡å¼');
                    } catch (error) {
                        console.error('åŠ è½½ä¿å­˜çš„æ¨¡å¼å¤±è´¥:', error);
                    }
                }
            }

            updateStatus(message) {
                document.getElementById('statusBar').textContent = message;
                setTimeout(() => {
                    if (!this.isPlaying && !this.isRecording) {
                        document.getElementById('statusBar').textContent = 'å‡†å¤‡å°±ç»ª - å¼€å§‹åˆ›ä½œä½ çš„èŠ‚æ‹ï¼';
                    }
                }, 3000);
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        document.addEventListener('DOMContentLoaded', () => {
            new BeatCreator();
        });

        // æ·»åŠ è§¦æ‘¸æ”¯æŒ
        document.addEventListener('touchstart', function(e) {
            e.preventDefault();
        }, { passive: false });

        // æ€§èƒ½ä¼˜åŒ–
        let lastUpdate = 0;
        function throttle(func, limit) {
            let inThrottle;
            return function() {
                const args = arguments;
                const context = this;
                if (!inThrottle) {
                    func.apply(context, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            }
        }
    </script>
</body>
</html>