<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>高级HLS播放器 - 悬停操作 & 倍速播放</title>
    <meta name="description" content="支持.m3u8流解析、实时码率切换，内置开发者调试模式，适用于在线教育/企业直播场景" />
    <meta property="og:type" content="tool" />
    <link rel="stylesheet" href="assets/css/layui.min.css">
    <script src="assets/js/layui.min.js"></script>
    <script src="assets/js/vendor/hls.min.js"></script>
    <script src="assets/js/vendor/sortable.min.js"></script>
    <link rel="stylesheet" href="assets/css/fontawesome.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg, #f0f6ff 0%, #e6f0ff 100%);
            min-height: 100vh;
            padding: 15px;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            border-radius: 16px;
            overflow: hidden;
            background: white;
        }

        .header {
            background: linear-gradient(120deg, #1E9FFF 0%, #0d8bf2 100%);
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            min-width: 250px;
        }

        .logo i {
            font-size: 28px;
            background: rgba(255, 255, 255, 0.2);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo h1 {
            font-size: 22px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .logo p {
            font-size: 14px;
            opacity: 0.9;
            margin-top: 4px;
        }

        .header-info {
            flex: 1;
            min-width: 250px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 50px;
            max-width: 300px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #95a5a6;
        }

        .status-dot.playing {
            background: #5FB878;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.4;
            }

            100% {
                opacity: 1;
            }
        }

        .main-content {
            display: flex;
            flex-wrap: wrap;
            padding: 0;
        }

        .player-section {
            flex: 2;
            min-width: 300px;
            padding: 20px;
            border-right: 1px solid #eee;
        }

        .control-section {
            flex: 1;
            min-width: 300px;
            padding: 20px;
            background: #fafbfc;
        }

        .section-title {
            font-size: 18px;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #1E9FFF;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            color: #1E9FFF;
            background: rgba(30, 159, 255, 0.1);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #video-container {
            width: 100%;
            height: 0;
            padding-bottom: 56.25%;
            /* 16:9 aspect ratio */
            position: relative;
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        #video-player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            outline: none;
        }

        .url-input {
            display: flex;
            margin-bottom: 15px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(30, 159, 255, 0.15);
        }

        .url-input input {
            flex: 1;
            height: 46px;
            border: none;
            padding: 0 18px;
            font-size: 15px;
            outline: none;
            background: #f8fafc;
        }

        .url-input button {
            background: #1E9FFF;
            color: white;
            border: none;
            padding: 0 22px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .url-input button:hover {
            background: #0d8bf2;
        }

        .player-controls {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .player-controls button {
            height: 46px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
        }

        .player-controls button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .player-controls .play-btn {
            background: #1E9FFF;
            color: white;
        }

        .player-controls .pause-btn {
            background: #FFB800;
            color: white;
        }

        .player-controls .mute-btn {
            background: #5FB878;
            color: white;
        }

        .player-controls .fullscreen-btn {
            background: #2F4056;
            color: white;
        }

        .speed-control {
            grid-column: span 4;
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f8fafc;
            border-radius: 8px;
            padding: 0 15px;
            height: 46px;
        }

        .speed-control label {
            font-weight: 500;
            color: #1E9FFF;
            white-space: nowrap;
        }

        .speed-control select {
            flex: 1;
            height: 36px;
            border: none;
            background: transparent;
            font-size: 14px;
            outline: none;
            cursor: pointer;
        }

        .video-info {
            background: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            border-left: 3px solid #1E9FFF;
            font-size: 14px;
        }

        .info-item {
            display: flex;
            margin-bottom: 10px;
        }

        .info-label {
            width: 90px;
            font-weight: 600;
            color: #1E9FFF;
        }

        .info-value {
            flex: 1;
            color: #555;
            word-break: break-all;
        }

        .favorites-container {
            margin-top: 15px;
        }

        .favorites-list {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 8px;
        }

        .favorite-item {
            display: flex;
            background: white;
            border-radius: 10px;
            padding: 14px 60px 14px 40px;
            /* 右侧留出操作按钮空间 */
            margin-bottom: 12px;
            align-items: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #e8e8e8;
            transition: all 0.3s;
            cursor: move;
            /* 拖拽光标 */
            position: relative;
        }

        .favorite-item:hover {
            transform: translateY(-3px);
            border-color: #1E9FFF;
            box-shadow: 0 5px 15px rgba(30, 159, 255, 0.15);
        }

        .fav-icon {
            width: 38px;
            height: 38px;
            background: rgba(30, 159, 255, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #1E9FFF;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .fav-content {
            flex: 1;
            min-width: 0;
            /* 防止内容溢出 */
            overflow: hidden;
        }

        .fav-content .title {
            font-weight: 500;
            margin-bottom: 5px;
            color: #2c3e50;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .fav-content .url {
            font-size: 12px;
            color: #7f8c8d;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .fav-actions {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 8px;
            background: white;
            padding: 5px;
            border-radius: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
        }

        .favorite-item:hover .fav-actions {
            opacity: 1;
            transform: translateY(-50%) translateX(0);
        }

        .fav-actions button {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .fav-actions button:hover {
            transform: scale(1.1);
        }

        .fav-actions .play-btn {
            background: rgba(30, 159, 255, 0.1);
            color: #1E9FFF;
        }

        .fav-actions .download-btn {
            background: rgba(95, 184, 120, 0.1);
            color: #5FB878;
        }

        .fav-actions .delete-btn {
            background: rgba(255, 87, 34, 0.1);
            color: #FF5722;
        }

        .add-favorite {
            display: flex;
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(95, 184, 120, 0.2);
        }

        .add-favorite input {
            flex: 1;
            height: 46px;
            border: none;
            padding: 0 18px;
            font-size: 14px;
            outline: none;
            background: #f8fafc;
        }

        .add-favorite button {
            background: #5FB878;
            color: white;
            border: none;
            padding: 0 22px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .add-favorite button:hover {
            background: #4caa6a;
        }

        .empty-list {
            text-align: center;
            padding: 30px 15px;
            color: #95a5a6;
        }

        .empty-list i {
            font-size: 42px;
            margin-bottom: 12px;
            color: #dce4e9;
        }

        .empty-list p {
            font-size: 15px;
        }

        .footer {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
            font-size: 14px;
            background: #f8fafc;
            border-top: 1px solid #eee;
        }

        /* 移动端适配 */
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }

            .player-section {
                border-right: none;
                border-bottom: 1px solid #eee;
            }

            .player-controls {
                grid-template-columns: repeat(2, 1fr);
            }

            .header {
                flex-direction: column;
                text-align: center;
                gap: 15px;
                padding: 15px;
            }

            .logo {
                justify-content: center;
                text-align: center;
            }

            .status-indicator {
                max-width: 100%;
                justify-content: center;
            }

            .section-title {
                font-size: 17px;
            }

            .url-input button,
            .add-favorite button {
                padding: 0 15px;
                font-size: 14px;
            }

            .player-controls button {
                font-size: 13px;
                padding: 0 8px;
            }

            .fav-actions {
                opacity: 1;
                /* 在移动端始终显示操作按钮 */
                transform: translateY(-50%) scale(0.9);
                right: 5px;
            }

            .favorite-item {
                padding: 12px 55px 12px 35px;
            }
        }

        @media (max-width: 480px) {
            .container {
                border-radius: 12px;
            }

            .player-section,
            .control-section {
                padding: 15px;
            }

            .player-controls {
                gap: 10px;
            }

            .favorite-item {
                padding: 10px 50px 10px 30px;
            }

            .footer {
                padding: 15px;
                font-size: 13px;
            }
        }

        /* 拖拽排序样式 */
        .sortable-ghost {
            opacity: 0.6;
            background: #f0f8ff;
            border: 1px dashed #1E9FFF;
        }

        .sortable-chosen {
            box-shadow: 0 0 15px rgba(30, 159, 255, 0.2);
        }

        .drag-handle {
            position: absolute;
            left: 5px;
            top: 50%;
            transform: translateY(-50%);
            color: #ccc;
            cursor: move;
            opacity: 0.5;
            transition: opacity 0.3s;
        }

        .favorite-item:hover .drag-handle {
            opacity: 1;
        }

        .speed-indicator {
            display: inline-block;
            background: #1E9FFF;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 5px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <i class="fas fa-play-circle"></i>
                <div>
                    <h1>高级HLS播放器</h1>
                    <p>悬停操作 | 倍速播放 | 优化体验</p>
                </div>
            </div>
            <div class="header-info">
                <div class="status-indicator">
                    <span class="status-dot" id="status-dot"></span>
                    <span id="player-status">等待播放</span>
                    <span class="speed-indicator" id="speed-indicator">1.0x</span>
                </div>
            </div>
        </div>
        <div class="main-content">
            <div class="player-section">
                <div class="section-title">
                    <i class="fas fa-play"></i>
                    <span>视频播放器</span>
                </div>
                <div id="video-container">
                    <video id="video-player" controls playsinline></video>
                </div>
                <div class="url-input">
                    <input type="text" id="video-url" placeholder="请输入.m3u8视频地址..." value="https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8">
                    <button id="play-btn">
                        <i class="fas fa-play"></i> 播放
                    </button>
                </div>
                <div class="player-controls">
                    <button class="play-btn" id="start-play">
                        <i class="fas fa-play"></i> 播放
                    </button>
                    <button class="pause-btn" id="pause-play">
                        <i class="fas fa-pause"></i> 暂停
                    </button>
                    <button class="mute-btn" id="toggle-mute">
                        <i class="fas fa-volume-up"></i> 静音
                    </button>
                    <button class="fullscreen-btn" id="fullscreen">
                        <i class="fas fa-expand"></i> 全屏
                    </button>
                    <div class="speed-control">
                        <label for="playback-speed"><i class="fas fa-tachometer-alt"></i> 倍速:</label>
                        <select id="playback-speed">
                            <option value="0.5">0.5x - 慢速</option>
                            <option value="1.0" selected>1.0x - 正常</option>
                            <option value="1.5">1.5x - 稍快</option>
                            <option value="2.0">2.0x - 快速</option>
                            <option value="2.5">2.5x - 倍速</option>
                            <option value="3.0">3.0x - 极速</option>
                        </select>
                    </div>
                </div>
                <div class="video-info">
                    <div class="info-item">
                        <span class="info-label">视频格式：</span>
                        <span class="info-value">HLS (HTTP Live Streaming)</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">支持格式：</span>
                        <span class="info-value">.m3u8, .mp4, .webm, .ogg</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">当前地址：</span>
                        <span class="info-value" id="current-url">未加载视频</span>
                    </div>
                </div>
            </div>
            <div class="control-section">
                <div class="section-title">
                    <i class="fas fa-star"></i>
                    <span>收藏功能</span>
                </div>
                <div class="add-favorite">
                    <input type="text" id="favorite-title" placeholder="输入收藏名称...">
                    <button id="add-favorite">
                        <i class="fas fa-plus"></i> 添加
                    </button>
                </div>
                <div class="favorites-container">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h3 style="color: #2c3e50; font-weight: 500;">
                            <i class="fas fa-list"></i> 我的收藏列表
                        </h3>
                        <span style="font-size: 13px; color: #7f8c8d;">拖拽可排序 | 悬停显示操作</span>
                    </div>
                    <div class="favorites-list" id="favorites-container">
                        <div class="favorite-item">
                            <div class="drag-handle">
                                <i class="fas fa-grip-lines"></i>
                            </div>
                            <div class="fav-icon">
                                <i class="fas fa-film"></i>
                            </div>
                            <div class="fav-content">
                                <div class="title">示例收藏：测试视频流</div>
                                <div class="url">https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8</div>
                            </div>
                            <div class="fav-actions">
                                <button class="play-btn" title="播放">
                                    <i class="fas fa-play"></i>
                                </button>
                                <button class="download-btn" title="下载">
                                    <i class="fas fa-download"></i>
                                </button>
                                <button class="delete-btn" title="删除">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="favorite-item">
                            <div class="drag-handle">
                                <i class="fas fa-grip-lines"></i>
                            </div>
                            <div class="fav-icon">
                                <i class="fas fa-video"></i>
                            </div>
                            <div class="fav-content">
                                <div class="title">演示收藏：Big Buck Bunny</div>
                                <div class="url">https://multiplatform-f.akamaihd.net/i/multi/will/bunny/big_buck_bunny_640x360_1mbps.f4v</div>
                            </div>
                            <div class="fav-actions">
                                <button class="play-btn" title="播放">
                                    <i class="fas fa-play"></i>
                                </button>
                                <button class="download-btn" title="下载">
                                    <i class="fas fa-download"></i>
                                </button>
                                <button class="delete-btn" title="删除">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer">
            <p>© 2025 高级HLS播放器 | 悬停操作与倍速播放优化版 | 基于LayUI和hls.js开发</p>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // 初始化layui模块
            layui.use(['layer'], function () {
                const layer = layui.layer;

                // 获取DOM元素
                const video = document.getElementById('video-player');
                const videoUrlInput = document.getElementById('video-url');
                const playBtn = document.getElementById('play-btn');
                const startPlayBtn = document.getElementById('start-play');
                const pausePlayBtn = document.getElementById('pause-play');
                const toggleMuteBtn = document.getElementById('toggle-mute');
                const fullscreenBtn = document.getElementById('fullscreen');
                const playerStatus = document.getElementById('player-status');
                const statusDot = document.getElementById('status-dot');
                const currentUrl = document.getElementById('current-url');
                const addFavoriteBtn = document.getElementById('add-favorite');
                const favoriteTitleInput = document.getElementById('favorite-title');
                const favoritesContainer = document.getElementById('favorites-container');
                const speedSelect = document.getElementById('playback-speed');
                const speedIndicator = document.getElementById('speed-indicator');

                let hls = null;
                let sortable = null;
                let currentPlaybackRate = 1.0; // 默认1倍速

                // 初始化HLS播放器
                function initPlayer(url) {
                    if (hls) {
                        hls.destroy();
                    }

                    currentUrl.textContent = url;

                    if (Hls.isSupported()) {
                        hls = new Hls();
                        hls.loadSource(url);
                        hls.attachMedia(video);
                        hls.on(Hls.Events.MANIFEST_PARSED, function () {
                            // 设置倍速
                            video.playbackRate = currentPlaybackRate;
                            speedIndicator.textContent = currentPlaybackRate.toFixed(1) + 'x';

                            updateStatus('已加载视频，准备播放');
                            video.play().catch(e => {
                                updateStatus('自动播放被阻止，请手动点击播放');
                            });
                        });
                    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                        // 对于Safari浏览器
                        video.src = url;
                        video.addEventListener('loadedmetadata', function () {
                            // 设置倍速
                            video.playbackRate = currentPlaybackRate;
                            speedIndicator.textContent = currentPlaybackRate.toFixed(1) + 'x';

                            updateStatus('已加载视频，准备播放');
                            video.play().catch(e => {
                                updateStatus('自动播放被阻止，请手动点击播放');
                            });
                        });
                    } else {
                        layer.msg('您的浏览器不支持HLS播放', { icon: 5 });
                    }
                }

                // 更新播放状态
                function updateStatus(text) {
                    playerStatus.textContent = text;

                    if (text.includes('播放中')) {
                        statusDot.className = 'status-dot playing';
                    } else if (text.includes('暂停') || text.includes('等待')) {
                        statusDot.className = 'status-dot';
                    } else {
                        statusDot.className = 'status-dot';
                    }
                }

                // 播放按钮事件
                playBtn.addEventListener('click', function () {
                    const url = videoUrlInput.value.trim();
                    if (url) {
                        updateStatus('正在加载视频...');
                        initPlayer(url);
                    } else {
                        layer.msg('请输入有效的视频地址', { icon: 5 });
                    }
                });

                // 开始播放
                startPlayBtn.addEventListener('click', function () {
                    if (video.src) {
                        video.play();
                        updateStatus('播放中... (' + currentPlaybackRate.toFixed(1) + 'x)');
                    } else {
                        layer.msg('请先加载视频', { icon: 5 });
                    }
                });

                // 暂停播放
                pausePlayBtn.addEventListener('click', function () {
                    video.pause();
                    updateStatus('已暂停');
                });

                // 静音切换
                toggleMuteBtn.addEventListener('click', function () {
                    video.muted = !video.muted;
                    if (video.muted) {
                        toggleMuteBtn.innerHTML = '<i class="fas fa-volume-mute"></i> 取消静音';
                        updateStatus('已静音');
                    } else {
                        toggleMuteBtn.innerHTML = '<i class="fas fa-volume-up"></i> 静音';
                        updateStatus('播放中... (' + currentPlaybackRate.toFixed(1) + 'x)');
                    }
                });

                // 全屏模式
                fullscreenBtn.addEventListener('click', function () {
                    if (video.requestFullscreen) {
                        video.requestFullscreen();
                    } else if (video.mozRequestFullScreen) {
                        video.mozRequestFullScreen();
                    } else if (video.webkitRequestFullscreen) {
                        video.webkitRequestFullscreen();
                    } else if (video.msRequestFullscreen) {
                        video.msRequestFullscreen();
                    }
                });

                // 倍速控制
                speedSelect.addEventListener('change', function () {
                    const speed = parseFloat(this.value);
                    currentPlaybackRate = speed; // 更新当前倍速
                    video.playbackRate = speed;
                    speedIndicator.textContent = speed.toFixed(1) + 'x';

                    if (!video.paused) {
                        updateStatus('播放中... (' + speed.toFixed(1) + 'x)');
                    }
                });

                // 视频事件监听
                video.addEventListener('play', function () {
                    updateStatus('播放中... (' + currentPlaybackRate.toFixed(1) + 'x)');
                });

                video.addEventListener('pause', function () {
                    updateStatus('已暂停');
                });

                video.addEventListener('ended', function () {
                    updateStatus('播放结束');
                });

                video.addEventListener('error', function () {
                    updateStatus('播放出错，请检查视频地址');
                });

                // 收藏功能
                function loadFavorites() {
                    favoritesContainer.innerHTML = '';
                    const favorites = JSON.parse(localStorage.getItem('videoFavorites')) || [];

                    if (favorites.length === 0) {
                        favoritesContainer.innerHTML = `
                            <div class="empty-list">
                                <i class="fas fa-star"></i>
                                <p>暂无收藏内容</p>
                            </div>
                        `;
                        initSortable(); // 初始化空列表的Sortable
                        return;
                    }

                    favorites.forEach((fav, index) => {
                        const item = document.createElement('div');
                        item.className = 'favorite-item';
                        item.innerHTML = `
                            <div class="drag-handle">
                                <i class="fas fa-grip-lines"></i>
                            </div>
                            <div class="fav-icon">
                                <i class="fas fa-film"></i>
                            </div>
                            <div class="fav-content">
                                <div class="title">${fav.title}</div>
                                <div class="url">${fav.url}</div>
                            </div>
                            <div class="fav-actions">
                                <button class="play-btn play-fav" data-url="${fav.url}" title="播放">
                                    <i class="fas fa-play"></i>
                                </button>
                                <button class="download-btn download-fav" data-url="${fav.url}" title="下载">
                                    <i class="fas fa-download"></i>
                                </button>
                                <button class="delete-btn delete-fav" data-index="${index}" title="删除">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        `;
                        favoritesContainer.appendChild(item);
                    });

                    // 添加收藏项事件
                    document.querySelectorAll('.play-fav').forEach(btn => {
                        btn.addEventListener('click', function () {
                            const url = this.getAttribute('data-url');
                            videoUrlInput.value = url;
                            updateStatus('正在加载收藏的视频...');
                            initPlayer(url);
                        });
                    });

                    document.querySelectorAll('.download-fav').forEach(btn => {
                        btn.addEventListener('click', function () {
                            const url = this.getAttribute('data-url');
                            downloadVideo(url);
                        });
                    });

                    document.querySelectorAll('.delete-fav').forEach(btn => {
                        btn.addEventListener('click', function () {
                            const index = parseInt(this.getAttribute('data-index'));
                            const favorites = JSON.parse(localStorage.getItem('videoFavorites')) || [];
                            favorites.splice(index, 1);
                            localStorage.setItem('videoFavorites', JSON.stringify(favorites));
                            loadFavorites();
                            layer.msg('已删除收藏', { icon: 1 });
                        });
                    });

                    // 初始化拖拽排序
                    initSortable();
                }

                // 下载视频函数
                function downloadVideo(url) {
                    if (url) {
                        // 创建下载链接
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = url.split('/').pop() || 'video_stream';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);

                        layer.msg('已开始下载视频', { icon: 1 });
                    } else {
                        layer.msg('没有可下载的视频地址', { icon: 5 });
                    }
                }

                // 初始化拖拽排序功能
                function initSortable() {
                    if (sortable) {
                        sortable.destroy();
                    }

                    sortable = new Sortable(favoritesContainer, {
                        animation: 150,
                        ghostClass: 'sortable-ghost',
                        chosenClass: 'sortable-chosen',
                        handle: '.drag-handle',
                        onEnd: function (evt) {
                            // 获取当前收藏列表
                            const favorites = JSON.parse(localStorage.getItem('videoFavorites')) || [];

                            // 重新排序数组
                            const newIndex = evt.newIndex;
                            const oldIndex = evt.oldIndex;

                            if (newIndex >= favorites.length) {
                                var k = newIndex - favorites.length + 1;
                                while (k--) {
                                    favorites.push(undefined);
                                }
                            }
                            favorites.splice(newIndex, 0, favorites.splice(oldIndex, 1)[0]);

                            // 保存更新后的收藏列表
                            localStorage.setItem('videoFavorites', JSON.stringify(favorites));
                        }
                    });
                }

                // 添加收藏
                addFavoriteBtn.addEventListener('click', function () {
                    const url = videoUrlInput.value.trim();
                    const title = favoriteTitleInput.value.trim();

                    if (!url) {
                        layer.msg('请先输入视频地址', { icon: 5 });
                        return;
                    }

                    if (!title) {
                        layer.msg('请输入收藏名称', { icon: 5 });
                        return;
                    }

                    // 检查是否是有效的URL
                    if (!url.startsWith('http')) {
                        layer.msg('请输入有效的视频地址', { icon: 5 });
                        return;
                    }

                    const favorites = JSON.parse(localStorage.getItem('videoFavorites')) || [];

                    // 检查是否已存在
                    if (favorites.some(fav => fav.url === url)) {
                        layer.msg('该视频已在收藏列表中', { icon: 5 });
                        return;
                    }

                    favorites.push({ title, url });
                    localStorage.setItem('videoFavorites', JSON.stringify(favorites));
                    favoriteTitleInput.value = '';
                    loadFavorites();
                    layer.msg('已添加到收藏', { icon: 1 });
                });

                // 初始化页面
                loadFavorites();
                updateStatus('等待播放');

                // 设置默认视频
                setTimeout(() => {
                    if (videoUrlInput.value) {
                        updateStatus('正在加载默认视频...');
                        initPlayer(videoUrlInput.value);
                    }
                }, 1000);

                // 移动端触摸事件优化
                if ('ontouchstart' in window) {
                    // 为控制按钮添加触摸反馈
                    const buttons = document.querySelectorAll('button');
                    buttons.forEach(btn => {
                        btn.addEventListener('touchstart', function () {
                            this.classList.add('active');
                        });
                        btn.addEventListener('touchend', function () {
                            this.classList.remove('active');
                        });
                    });
                }
            });
        });
    </script>
</body>

</html>